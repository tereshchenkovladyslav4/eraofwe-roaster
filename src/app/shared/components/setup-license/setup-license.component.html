<div class="main-block">
    <div class="breadcrumb-mb">
        <app-back-link (handleBack)="close()"></app-back-link>
    </div>

    <div>
        <div class="fnt-18 fw-b text-center text-md-left mb-1">
            {{ 'license' | translate }} & {{ 'certificates' | translate }}
        </div>
        <div class="fw-m txt-clr588">{{ 'upload_certificates_note' | translate }}</div>
    </div>

    <div class="license-content-wrapper">
        <div class="pt-45 pt-md-5">
            <ng-container *ngFor="let certificationItem of certificationArray; let i = index">
                <div
                    class="certification-item d-flex align-items-center justify-content-between br-4 bg-f8 px-3 mb-3 mb-md-4"
                    *ngIf="i !== editingRowIndex; else addAndEditTemplate"
                >
                    <div class="d-flex pt-2 pr-0 pb-2 pl-2 align-items-center">
                        <img class="d-none d-lg-block mr-4" src="assets/images/reorder.svg" alt="certification" />
                        <label class="fw-m mb-0">{{ certificationItem.certificate_type_name }}</label>
                        <p-divider class="divider border-none" layout="vertical"></p-divider>
                        <label class="fw-m mb-0">{{ certificationItem.year }}</label>
                    </div>
                    <div class="d-flex pt-2 pr-0 pb-2 pl-2 align-items-center">
                        <span class="fw-m text-clr97 cursor-pointer" (click)="onEdit(i)">
                            <i class="pi pi-pencil mr-2"></i>
                            {{ 'edit' | translate }}
                        </span>
                        <p-divider class="divider border-none" layout="vertical"></p-divider>
                        <span class="fw-m text-clr97 cursor-pointer" (click)="onDelete(i)">
                            <i class="pi pi-trash mr-2"></i>
                            {{ 'delete' | translate }}
                        </span>
                    </div>
                </div>
            </ng-container>
            <div class="mt-2" *ngIf="editingRowIndex === -1 || !certificationArray.length">
                <ng-container *ngTemplateOutlet="addAndEditTemplate"></ng-container>
            </div>
            <span class="brown-cta" (click)="onAdd()">+ {{ 'add_another_certificate' | translate }} </span>
        </div>
        <div class="py-2 py-lg-3">
            <p-divider type="dashed"></p-divider>
        </div>
        <div class="mt-1 mb-3 mb-md-5">
            <button class="btn-stroked" (click)="close()">
                {{ 'cancel' | translate }}
            </button>
        </div>
        <input #myFileInput type="file" class="d-none" (change)="onFileChange($event)" />
    </div>

    <ng-template #addAndEditTemplate>
        <div class="d-flex flex-wrap flex-column flex-lg-row pb-3 pb-lg-0">
            <div class="d-flex flex-wrap pr-lg-25 certification-wrapper">
                <div class="p-0 pr-md-2 pr-lg-25 sewn-form-field mb-3 certification-name">
                    <label>{{ 'certification_name' | translate }}</label>
                    <p-dropdown
                        [options]="certificateList"
                        optionLabel="name"
                        optionValue="id"
                        [(ngModel)]="
                            editingRowIndex < 0
                                ? selectedCertification
                                : certificationArray[editingRowIndex].certificate_type_id
                        "
                        [placeholder]="'enter_certification_name' | translate"
                        [autoDisplayFirst]="false"
                        (onChange)="onChangeType($event)"
                    >
                        <ng-template let-item pTemplate="item">
                            {{ item.type | sentencecase }}
                        </ng-template>
                    </p-dropdown>
                </div>
                <div class="p-0 pl-md-2 pl-lg-25 sewn-form-field mb-3 certification-year">
                    <label>{{ 'year_of_certification' | translate }}</label>
                    <p-dropdown
                        [options]="yearList"
                        [(ngModel)]="
                            editingRowIndex < 0 ? selectedCertificationYear : certificationArray[editingRowIndex].year
                        "
                        [placeholder]="'please_select_year' | translate"
                        [autoDisplayFirst]="false"
                        (onChange)="onChangeYear($event)"
                    ></p-dropdown>
                </div>
            </div>
            <div class="pl-lg-25">
                <label class="fw-m mb-2">{{ 'upload_certificate' | translate }}</label>
                <div
                    class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between"
                >
                    <div class="file-name" *ngIf="file || certificationArray[editingRowIndex]?.public_url">
                        <span class="fw-m text-clr588 mb-0 ellipsis">
                            {{ file?.name || certificationArray[editingRowIndex]?.public_url.split('/').pop() }}
                        </span>
                        <i class="pi pi-times fnt-14 text-clr588 ml-25 cursor-pointer" (click)="onRemoveFile()"></i>
                    </div>
                    <div
                        class="btn-trans-icon upload-icon mr-md-4"
                        (click)="onUpload()"
                        *ngIf="!file && !certificationArray[editingRowIndex]?.public_url"
                    >
                        {{ 'upload' | translate }}
                    </div>
                    <div class="d-flex flex-column flex-md-row button-wrapper align-items-center">
                        <button class="btn-raised ml-md-4 mt-3 mt-md-0" (click)="onSave()">
                            {{ 'save' | translate }}
                        </button>
                        <button class="btn-stroked ml-md-3" *ngIf="editingRowIndex > -1" (click)="onCancel()">
                            {{ 'cancel' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </ng-template>
</div>
