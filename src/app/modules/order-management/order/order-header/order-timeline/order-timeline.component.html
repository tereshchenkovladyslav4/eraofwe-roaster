<ng-template #timeline>
    <div class="transit-scoll overflow-hidden overflow-md-auto mt-md-4">
        <div class="transit-maxwidth main-order-tracking-mbVesrion">
            <div class="w-100 d-flex flex-column flex-md-row">
                <div class="d-flex flex-column align-items-center order-tracking"
                    [class.completed]="index > currentPointIndex"
                    *ngFor="let point of timelinePoints; let index = index; let last = last">
                    <span class="d-block is-complete"></span>
                    <div class="text-md-center order-tracking__mb-text mt-order-0 ml-2 ml-md-0">
                        <p class="order-status fnt-13 font-bold text-clr334 mt-md-2 mb-1"
                            [class.text-muted]="index > currentPointIndex">
                            {{point.label}}
                        </p>

                        <p class="view-order cursor-pointer mb-0" *ngIf="isPrebook && index === 3; else statusInfo">
                            {{ 'view_lot_status' | translate }}
                        </p>
                        <ng-template #statusInfo>
                            <p class="mb-0 fnt-14 fnt-sm-12 text-muted font-bold d-lg-block d-md-none d-sm-block"
                                *ngIf="index < 2">By :
                                <span class="text-underline">{{ getStatusAuthor(point) }}</span>
                            </p>
                            <p class="pt-1 fnt-12 d-lg-block d-md-none d-sm-block">{{ getStatusDate(point) |
                                date : 'd MMMM y' }}</p>
                        </ng-template>

                        <ng-container *ngIf="last && isGraded">
                            <label class="order-datecolor mb-0" *ngIf="!isGraded" (click)="upload.click()">
                                {{ 'upload_report' | translate }}
                            </label>
                            <input hidden type="file" #upload />
                            <p class="order-datecolor mb-0" *ngIf="isGraded">
                                {{ 'view_report' | translate}}
                            </p>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<div class="in-order mt-3 pb-lg-2" *ngIf="!showTextBlock">
    <div class="row">
        <div class="col-12 col-md-12">
            <ng-container *ngIf="(isMobile$ | async) !== true; else mobileTimeline">
                <h4 class="fnt-play fnt-700 fnt-24 text-clr334 mb-4 mb-md-2">
                    {{ statusLabel }}
                </h4>
                <ng-container *ngTemplateOutlet="timeline"></ng-container>
            </ng-container>
            <div class="btn-div col-md-6 pl-0 pr-0 d-inline-block d-md-none mb-2"
                [class.invoice-block]="accordionOpened">
                <button type="submit" class="btn-raised pull-right w-100 text-center" (click)="openInvoice()">
                    {{ 'order_invoice' | translate }}
                </button>
            </div>
        </div>
    </div>
</div>

<ng-template #mobileTimeline>
    <p-accordion (onOpen)="accordionOpened = true" (onClose)="accordionOpened = false">
        <p-accordionTab #tab [selected]="true">
            <ng-template pTemplate="header">
                <div class="w-100 fnt-play fnt-700 fnt-18 text-clr334 mb-4 mb-md-2">
                    <span>{{ statusLabel }}</span>
                    <img class="pl-2 pt-2 mt-1 pull-right" src="assets/images/collapse-arrow.svg"
                        *ngIf="!tab.selected" />
                    <img class="pl-2 pt-2 mt-1 pull-right" src="assets/images/expand-arrow.svg" *ngIf="tab.selected" />
                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <ng-container *ngTemplateOutlet="timeline"></ng-container>
            </ng-template>
        </p-accordionTab>
    </p-accordion>
</ng-template>

<ng-container *ngIf="order && showTextBlock">
    <ng-container [ngSwitch]="order.orderType">
        <div class="in-order mt-4 confirm-shippment" *ngSwitchCase="OrderTypes.Sample">
            <div class="row">
                <div class="col-lg-9 col-md-8 col-sm-12 d-flex px-2 px-md-3">
                    <div class="img-block d-none d-md-block">
                        <span class="circle-image"> <img src="assets/images/timeline-check-active.svg" /></span>
                    </div>
                    <div class="txt-block">
                        <h4 class="fnt-26 text-clr334 fnt-sm-18 fnt-play">Received on {{ receivedDate | date: 'd MMMM y' }}</h4>
                        <div class="fnt-16 fnt-sm-12 text-clr5d pt-2">
                            Wohoo! You have successfully recieved the bulk you ordered.
                        </div>
                        <div class="fnt-16 fnt-sm-12 text-clr5d">
                            Please Rate and Review the customer to help us expand as a transparent
                            community!
                        </div>
                        <button type="submit" class="btn-raised sm mt-3" [routerLink]="[orderId | orderRatingLink: orgType]">
                            Leave a feedback!
                        </button>
                        <button type="submit" class="btn-raised pull-right w-100 text-center mt-2 d-md-none"
                            (click)="openInvoice()">
                            {{ 'order_invoice' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="in-order mt-5 confirm-shippment" *ngSwitchCase="OrderTypes.Prebook">
            <div class="row">
                <div class="col-lg-9 col-md-8 col-sm-12 d-flex px-2 px-md-3">
                    <div class="col-md-12">
                        <h4 class="fnt-26 text-clr334 fnt-play">Waiting for a confirmation from Roaster</h4>
                        <div class="fnt-16 fnt-sm-12 text-clr5d pt-2">
                            The roaster will review the grade report and confirm the order.
                        </div>
                        <button type="submit" class="btn-raised sm mt-3" [routerLink]="[orderId | orderRatingLink: orgType]">
                            Leave a feedback!
                        </button>
                        <button type="submit" class="btn-raised pull-right w-100 text-center mt-2 d-md-none"
                            (click)="openInvoice()">
                            {{ 'order_invoice' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="in-order mt-4 confirm-shippment" *ngSwitchCase="OrderTypes.Booked">
            <div class="row">
                <div class="col-lg-9 col-md-8 col-sm-12 d-flex px-2 px-md-3">
                    <div class="img-block d-none d-md-block">
                        <span class="circle-image">
                            <img src="assets/images/timeline-check-active.png" />
                        </span>
                    </div>
                    <div class="txt-block">
                        <h4 class="fnt-26 fnt-sm-18 text-clr334 fnt-play">
                            Received on {{ receivedDate | date: 'd MMMM y' }}
                        </h4>
                        <div class="fnt-16 fnt-sm-12 text-clr5d pt-2">
                            Wohoo! You have successfully recieved the bulk you ordered.<br>
                            Please Rate and Review the customer to help us expand as a transparent
                            community!
                        </div>
                        <button type="submit" class="btn-raised sm mt-4" [routerLink]="[orderId | orderRatingLink: orgType]">
                            Leave a feedback!
                        </button>
                        <button type="submit" class="btn-raised pull-right w-100 text-center mt-2 d-md-none"
                            (click)="openInvoice()">
                            {{ 'order_invoice' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</ng-container>