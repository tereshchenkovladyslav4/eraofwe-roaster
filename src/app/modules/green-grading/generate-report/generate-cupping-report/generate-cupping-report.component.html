<section class="total-section prime-grid">
    <div class="back-page pb-45" (click)="back()">
        <a>
            <span>Back</span>
        </a>
    </div>
    <div class="d-flex flex-wrap justify-content-between">
        <span class="request-title-text">Generate Report</span>
    </div>
    <p class="fnt-14 fnt-muli fnt-normal fnt-400 text-clr588 mt-4 mt-md-2 mt-lg-1 mb-0 d-none d-md-block">
        Select the details of the report you want to generate
    </p>
    <div class="mt-2 mt-md-4">
        <app-estate-info
            [cuppingDetails]="cuppingDetails"
            [singleCuppingDetails]="singleCuppingDetails"
            [evaluatorName]="evaluatorName"
            (showDetail)="showDetail.emit()"
        ></app-estate-info>
    </div>

    <div
        *ngIf="selectedCuppingId && singleCuppingDetails"
        class="cupping-report single-cupping-report px-3 px-md-4 pt-3 pt-md-4 pb-0 pb-md-2"
    >
        <div class="d-flex justify-content-between align-itemscenter header-wrapper pr-1">
            <div>
                <div class="p-field-radiobutton pt-0 pl-0 pb-3 pb-md-2 ml-0">
                    <label for="version" class="ml-0"> Cupping Report {{ singleCuppingDetails.version }}.0 </label>
                </div>
                <p class="fnt-14 fnt-400 fnt-muli text-clr588 mb-0 pt-md-1 generate_date pl-0">
                    Generated on:
                    {{ singleCuppingDetails.generated_on | date: 'dd/MM/y' }}
                </p>
            </div>
            <div class="pb-3 pb-md-0">
                <p class="average_score_value">{{ singleCuppingDetails.average_score }}</p>
                <p class="average_score_label">Average score</p>
            </div>
        </div>
        <div class="bottom-dash d-block d-md-none ml-0 mb-1"></div>
        <p class="fnt-14 fnt-normal fnt-muli text-clr588 mb-3 pt-3 pt-md-2 md-mb-0">Selected Evaluators</p>
        <p
            class="fnt-14 fnt-600 fnt-muli text-clr334 my-3"
            *ngFor="let eval of evaluatorArray[selectedCuppingId]; let j = index"
        >
            {{ j + 1 }}. {{ eval.evaluator_name }}
            <span *ngIf="eval.is_primary == true">(You)</span>
            /{{ eval.evaluator_type }} ({{ eval.final_score }})
        </p>
    </div>
    <div class="cupping-report" *ngIf="!selectedCuppingId">
        <p-accordion (onOpen)="onOpen($event)" (onClose)="onClose($event)" styleClass="p-cuppings-accordion">
            <p-accordionTab *ngFor="let item of cuppingReports; let i = index" [(selected)]="activeState[i]">
                <ng-template pTemplate="header">
                    <div class="d-flex justify-content-between align-itemscenter header-wrapper">
                        <div>
                            <div class="p-field-radiobutton pb-3 pb-md-2">
                                <p-radioButton
                                    name="version"
                                    [value]="item.id"
                                    [(ngModel)]="cuppingReportId"
                                    [inputId]="i"
                                    styleClass="p-cuppings-radiobutton"
                                >
                                </p-radioButton>
                                <label class="pl-25" [for]="i"> Cupping Report {{ item.version }}.0 </label>
                            </div>
                            <p class="fnt-14 fnt-400 fnt-muli text-clr588 mb-0 generate_date">
                                Generated on:
                                {{ item.generated_on | date: 'dd/MM/y' }}
                            </p>
                        </div>
                        <div class="pl-3 pl-md-0 pb-3 pb-md-0">
                            <p class="average_score_value">{{ item.average_score }}</p>
                            <p class="average_score_label">Average score</p>
                        </div>
                        <div class="bottom-dash d-block d-md-none"></div>
                    </div>
                </ng-template>
                <ng-template pTemplate="content">
                    <p class="fnt-14 fnt-600 fnt-muli text-clr588 mb-3 md-mb-0">Selected Evaluators</p>
                    <p
                        class="fnt-14 fnt-600 fnt-muli text-clr334 my-3"
                        *ngFor="let eval of evaluatorArray[item.id]; let j = index"
                    >
                        {{ j + 1 }}. {{ eval.evaluator_name }}
                        <span *ngIf="eval.is_primary == true">(You)</span>
                        /{{ eval.evaluator_type }} ({{ eval.final_score }})
                    </p>
                </ng-template>
            </p-accordionTab>
        </p-accordion>
    </div>

    <!-- Re-grade sample -->
    <div
        class="d-flex justify-content-between align-items-start align-items-md-center flex-column flex-md-row-reverse w-100"
    >
        <div class="d-flex flex-md-row-reverse justify-content-end flex-column w-mob-100">
            <button
                class="btn-raised ml-md-2"
                (click)="completeReport()"
                *ngIf="cuppingDetails.cupping_status !== 'COMPLETED'"
            >
                {{ 'done' | translate }}
            </button>
            <button
                class="btn-stroked mt-md-0 mr-md-2"
                [ngClass]="{ 'mt-3': cuppingDetails.cupping_status !== 'COMPLETED' }"
                (click)="reGrade()"
            >
                Re-grade sample
            </button>
        </div>
        <div class="mt-3 mt-md-0 report-button-wrapper">
            <button
                pButton
                class="p-button-outlined mr-0 mr-md-3 mb-1 mb-md-0"
                label="Download as PDF"
                icon="pi pi-download"
                iconPos="left"
                (click)="downloadReport()"
            ></button>
        </div>
    </div>
</section>
