<div class="main-block">
    <div class="row mb-1">
        <div class="col-12 col-sm-12 col-md-12 col-lg-6 overflow-auto d-flex flex-nowrap breadCrumb">
            <p-breadcrumb [model]="breadItems"></p-breadcrumb>
        </div>
        <div class="col-12 col-sm-12 col-md-12 col-lg-6 spacing-batch">
            <button
                type="submit"
                class="btn pull-right btn-raised d-md-none d-none d-lg-block d-xl-block"
                routerLink="/roasted-coffee-batch/roasting-profile"
            >
                {{ 'manage_roasting_profiles' | translate }}
            </button>
            <button
                type="submit"
                class="btn pull-right btn-stroked d-md-none d-none mr-2 d-lg-block d-xl-block"
                routerLink="/roasted-coffee-batch/new-roasted-batch"
            >
                {{ 'create_new_batch' | translate }}
            </button>
        </div>
    </div>
    <div class="row mt-4 mt-md-0">
        <div class="col-12">
            <span class="primary_txt mb-1">{{ 'roasted_coffee_batches' | translate }}</span>
        </div>
    </div>
    <div class="row mb-3 mt-2 mt-md-1">
        <div class="col-12 col-sm-12 col-md-7">
            <span class="fnt-14 black fnt-normal fnt-muli inventory-text-height">{{
                'maintain_inventory_text' | translate
            }}</span>
        </div>

        <div class="d-none d-sm-none d-md-block col-5">
            <input
                type="text"
                name="search"
                class="search-raised pull-right"
                [(ngModel)]="termSearch"
                (ngModelChange)="getData()"
                placeholder="Search by batch name or ID"
            />
        </div>
    </div>
    <div class="row mt-4 mb-4 d-block d-sm-block d-md-none">
        <div class="col-12 col-sm-12">
            <button
                type="submit"
                class="btn btn-raised w-100"
                [routerLink]="['/roasted-coffee-batch/roasting-profile']"
            >
                Manage roasting profiles
            </button>
        </div>
        <div class="col-12 col-sm-12 mt-3">
            <button
                type="button"
                class="btn btn-stroked w-100"
                [routerLink]="['/roasted-coffee-batch/new-roasted-batch']"
            >
                Create a new batch
            </button>
        </div>
    </div>
    <div class="row">
        <div class="d-block d-sm-block d-md-none col-12 mb-3">
            <input
                type="text"
                name="search"
                class="search-raised w-100 ml-0"
                [(ngModel)]="termSearch"
                (ngModelChange)="getData()"
                placeholder="Search by batch name"
            />
        </div>
    </div>
    <div class="row pt-1">
        <div class="col-12 col-sm-12 col-md-4 col-lg-12 col-xl-12">
            <p-dropdown
                [options]="roastLevelArray"
                optionLabel="name"
                optionValue="id"
                [(ngModel)]="profileFilter"
                (ngModelChange)="getData()"
                scrollHeight="225px"
                [showClear]="true"
                placeholder="{{ 'roast_level' | translate }}"
                styleClass="round-border mb-3 {{ profileFilter ? 'highlight' : '' }}"
            >
            </p-dropdown>
        </div>
        <div class="col-md-8 d-none d-sm-none d-md-block d-lg-none d-xl-none">
            <button
                type="submit"
                class="btn pull-right btn-raised d-md-block"
                routerLink="/roasted-coffee-batch/roasting-profile"
            >
                {{ 'manage_roasting_profiles' | translate }}
            </button>
            <button
                type="submit"
                class="btn pull-right btn-stroked d-md-block mr-2"
                routerLink="/roasted-coffee-batch/new-roasted-batch"
            >
                {{ 'create_new_batch' | translate }}
            </button>
        </div>
    </div>

    <div class="table-container userTable mt-md-1 mt-2 mb-2 pt-0 roastedCoffeeTable">
        <p-table
            #myTable
            [value]="tableValue"
            [columns]="tableColumns"
            [(selection)]="selectedProfiles"
            dataKey="id"
            [resizableColumns]="true"
            [showCurrentPageReport]="false"
            [paginator]="true"
            [rows]="10"
            [loading]="isLoadingRoastedBatches"
            [lazy]="true"
            (onLazyLoad)="getData($event)"
            [totalRecords]="totalCount"
            selectionMode="multiple"
            [responsive]="true"
            styleClass="mobile-card-view"
        >
            <ng-template pTemplate="header" let-columns>
                <tr class="d-none d-sm-none d-md-table-row">
                    <th
                        *ngFor="let col of columns"
                        [style.width]="col.width ? col.width + '%' : '30%'"
                        [pSortableColumn]="col.sortable ? col.field : null"
                    >
                        <span class="primeng-table-header">{{ col.header | translate }}</span>
                        <p-sortIcon *ngIf="col.sortable" [field]="col.field"> </p-sortIcon>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns">
                <tr (click)="redirectToEdit(rowData)">
                    <td
                        *ngFor="let col of columns"
                        [ngSwitch]="col.field"
                        [style.width]="col.width ? col.width + '%' : '30%'"
                        [ngClass]="{
                            'd-none':
                                col.field == 'id' ||
                                col.field == 'created_at' ||
                                col.field == 'roasting_profile_quantity' ||
                                col.field == 'estate_name' ||
                                col.field == 'order_id' ||
                                col.field == 'roaster_ref_no' ||
                                col.field == 'actions' ||
                                col.field == 'roasting_profile_name',
                            'd-sm-none':
                                col.field == 'created_at' ||
                                col.field == 'roasting_profile_quantity' ||
                                col.field == 'estate_name' ||
                                col.field == 'order_id' ||
                                col.field == 'roaster_ref_no' ||
                                col.field == 'actions' ||
                                col.field == 'roasting_profile_name',
                            'd-md-table-cell':
                                col.field == 'id' ||
                                col.field == 'created_at' ||
                                col.field == 'roasting_profile_quantity' ||
                                col.field == 'estate_name' ||
                                col.field == 'order_id' ||
                                col.field == 'roaster_ref_no' ||
                                col.field == 'actions' ||
                                col.field == 'roasting_profile_name',
                            nameMobileHeader: col.field == 'roast_batch_name'
                        }"
                    >
                        <span *ngSwitchCase="'roast_batch_name'" class="">
                            <span class="d-none d-sm-none d-md-inline-block truncate-roasted">
                                {{ rowData['roast_batch_name'] | titlecase }}
                            </span>

                            <div class="d-block d-sm-block d-md-none row m-0 pb-4">
                                <div class="borderCard">
                                    <div class="d-flex bgCard">
                                        <span class="fnt-muli fnt-700 width-90">{{
                                            rowData[col.field] | titlecase
                                        }}</span>
                                        <span (click)="menuClicked()" class="">
                                            <a
                                                class="menu-arrow"
                                                [popover]="poplistTemplate"
                                                placement="left"
                                                [outsideClick]="true"
                                                #pop="bs-popover"
                                            >
                                                <img
                                                    class="ellipse-image pl-3"
                                                    src="assets/images/kebab-menu.svg"
                                                    alt=""
                                                />
                                            </a>
                                            <ng-template #poplistTemplate>
                                                <div id="popover-mobile-content">
                                                    <ul class="list-group custom-popover">
                                                        <li class="list-group-item">
                                                            <a
                                                                class="pointer-item"
                                                                (click)="deleteRoastedBatch(rowData['id'])"
                                                                >{{ 'delete' | translate }}</a
                                                            >
                                                        </li>
                                                    </ul>
                                                </div>
                                            </ng-template>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12 row p-3 m-0 mobileCard">
                                    <div class="cardBottom p-0 w-100">
                                        <div class="mobileCardBody pt-0">
                                            <div class="pb-35">
                                                <span class="fnt-muli fnt-600 black"
                                                    >{{ 'order_id' | translate }} #{{ rowData['order_id'] }}</span
                                                >
                                            </div>
                                            <div class="d-flex">
                                                <span class="secondary_txt width-head">Estate Name </span>
                                                <span class="width-desc primary_txt mobileValueTxt pl-3">{{
                                                    rowData['estate_name']
                                                }}</span>
                                            </div>
                                        </div>
                                        <div class="mobileCardBody d-flex">
                                            <span class="secondary_txt width-head">Roaster Ref. No.</span>
                                            <span class="width-desc primary_txt mobileValueTxt pl-3">{{
                                                rowData['roaster_ref_no']
                                            }}</span>
                                        </div>
                                        <div class="mobileCardBody d-flex">
                                            <span class="secondary_txt width-head">Quantity </span>
                                            <span class="width-desc primary_txt mobileValueTxt pl-3"
                                                >{{ rowData['roasting_profile_quantity'] }}
                                                {{ rowData['roasting_profile_unit'] }}</span
                                            >
                                        </div>
                                        <div class="pt-3 d-flex">
                                            <span class="width-head secondary_txt">Roasting profile</span>
                                            <span class="width-desc primary_txt mobileValueTxt pl-3">{{
                                                rowData['roasting_profile_name']
                                            }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </span>
                        <span *ngSwitchCase="'actions'" class="">
                            <span class="d-flex">
                                <a class="fnt-muli fnt-14 fnt-700 view-det">View details</a>
                                <span class="d-flex align-items-center" (click)="menuClicked()">
                                    <a
                                        class="menu-arrow"
                                        [popover]="poplistTemplate"
                                        placement="left"
                                        [outsideClick]="true"
                                        #pop="bs-popover"
                                    >
                                        <img class="ellipse-image pl-3" src="assets/images/kebab-menu.svg" alt="" />
                                    </a>
                                    <ng-template #poplistTemplate>
                                        <div id="popover-mobile-content">
                                            <ul class="list-group custom-popover">
                                                <li class="list-group-item">
                                                    <a
                                                        class="pointer-item"
                                                        (click)="deleteRoastedBatch(rowData['id']); pop.hide()"
                                                        >{{ 'delete' | translate }}</a
                                                    >
                                                </li>
                                            </ul>
                                        </div>
                                    </ng-template>
                                </span>
                            </span>
                        </span>
                        <span *ngSwitchCase="'created_at'" class="">
                            <span>{{ rowData[col.field] | date: 'dd MMM y' }}</span>
                        </span>
                        <span *ngSwitchCase="'roasting_profile_quantity'" class="">
                            <span>{{ rowData[col.field] }} {{ rowData['roasting_profile_unit'] }}</span>
                        </span>
                        <span *ngSwitchDefault>
                            <span>{{ rowData[col.field] || '-' }}</span>
                        </span>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
