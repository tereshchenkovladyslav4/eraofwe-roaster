<div *ngIf="isLoading">
    <app-loading></app-loading>
</div>

<div *ngIf="!isLoading">
    <div class="bg-f8 py-4">
        <p-tabView>
            <p-tabPanel [header]="'translation' | translate">
                <div class="p-4 bg-f8" [formGroup]="articleForm" novalidate>
                    <div class="sewn-form-field col-12 col-md-6 p-0">
                        <p-dropdown
                            [options]="applicationLanguages"
                            class="w-100"
                            formControlName="language"
                            required
                            [placeholder]="'select_translation_language' | translate"
                            optionLabel="label"
                            optionValue="value"
                        ></p-dropdown>
                        <div *ngIf="articleForm.controls.language.invalid" class="p-error">Required field</div>
                    </div>
                    <div class="col-12 sewn-form-field p-0">
                        <div class="addImageContainer d-flex align-items-center justify-content-center">
                            <img [src]="coverImageUrl" *ngIf="coverImageUrl" class="cover-image" />
                            <label class="cursor-pointer">
                                <input
                                    type="file"
                                    accept="image/png, image/jpeg"
                                    style="display: none"
                                    (change)="onFileChange($event)"
                                />
                                <div class="d-flex flex-column align-items-center">
                                    <img src="assets/images/plus-circle.svg" class="mb-2 mb-md-25" />
                                    <span class="fnt-muli fnt-14 fnt-600 lh-normal text-clr588 mb-2 mb-md-25"
                                        >{{ 'add_cover_image' | translate }}<span class="star">*</span></span
                                    >
                                    <span class="fnt-muli fnt-14 fnt-600 lh-normal text-clr588 mb-2 mb-md-25"
                                        >({{ 'max_size' | translate }} 2mb)</span
                                    >
                                </div>
                            </label>
                            <div
                                class="bg-f8 br-4 py-2 px-3 d-flex align-items-center justify-content-center copy-paste-button"
                                (click)="pasteCoverImage()"
                            >
                                <img src="assets/images/paste.svg" class="mr-1" />
                                <span class="fnt-muli fnt-14 fnt-600 lh-normal text-clr334 ml-1">{{
                                    'paste' | translate
                                }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 sewn-form-field p-0">
                        <input type="text" placeholder="Give a title" pInputText formControlName="title" />
                        <small *ngIf="articleForm.controls['title'].errors?.required" class="p-error">
                            {{ 'required' | translate }}
                        </small>
                    </div>
                    <div class="col-12 sewn-form-field p-0">
                        <input type="text" placeholder="subtitle" pInputText formControlName="subtitle" />
                        <small *ngIf="articleForm.controls['subtitle'].errors?.required" class="p-error">
                            {{ 'required' | translate }}
                        </small>
                    </div>
                    <div class="col-12 sewn-form-field p-0">
                        <app-forum-editor
                            [(content)]="content"
                            [(isUploadingImage)]="isUploadingImage"
                            [(imageIdList)]="imageIdList"
                            fileModule="cl-articles"
                        ></app-forum-editor>
                    </div>
                </div>
            </p-tabPanel>
            <p-tabPanel [header]="'see_original_post' | translate">
                <div class="p-4 bg-f8">
                    <div class="border-main bg-white p-4 br-4">
                        <div class="position-relative">
                            <img [src]="article?.cover_image_url" class="banner-image" />
                            <div
                                class="bg-f8 br-4 py-2 px-3 d-flex align-items-center justify-content-center copy-paste-button"
                                (click)="copyCoverImage()"
                            >
                                <img src="assets/images/copy.svg" class="mr-1" />
                                <span class="fnt-muli fnt-14 fnt-600 lh-normal text-clr334 ml-1">{{
                                    'copy' | translate
                                }}</span>
                            </div>
                        </div>
                        <p class="fnt-muli fnt-14 fnt-md-18 fnt-bold lh-normal text-clr334 pt-3 mb-3 mb-md-4">
                            {{ article?.title }}
                        </p>
                        <div class="article-content" appCopyImageToClipboard [innerHTML]="article.content"></div>
                    </div>
                </div>
            </p-tabPanel>
        </p-tabView>
        <div class="row mt-2 px-4">
            <div class="col-md-6 order-2 order-md-1">
                <button routerLink="/coffee-lab/overview/article" class="btn-stroked px-4 w-mob-100 mb-2 mb-md-0">
                    {{ 'cancel' | translate }}
                </button>
            </div>
            <div class="col-md-6 order-1 order-md-2">
                <div class="d-flex justify-content-end flex-column flex-md-row">
                    <button
                        [disabled]="isPosting || isUploadingImage"
                        (click)="onPost('draft')"
                        class="btn-stroked px-4 order-2 order-md-1 w-mob-100 mb-2 mb-md-0"
                    >
                        {{ 'save_as_draft' | translate }}
                    </button>
                    <button
                        [disabled]="isPosting || isUploadingImage"
                        (click)="onPost('published')"
                        class="btn-raised px-4 ml-md-3 order-1 order-md-2 w-mob-100 mb-2 mb-md-0"
                    >
                        {{ 'submit' | translate }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
