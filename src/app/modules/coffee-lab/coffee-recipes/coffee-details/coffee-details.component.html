<main>
    <div class="back-page mt-1 mt-lg-3 pb-35 pb-lg-45 w-fit-content" (click)="location.back()">
        <a>
            <span>{{ 'back' | translate }}</span>
        </a>
    </div>
    <app-loading *ngIf="isLoading"></app-loading>
    <div class="page-wrapper m-0" *ngIf="!isLoading">
        <article class="col-12 col-lg-8 p-0 pr-lg-3">
            <div class="p-3 py-md-45 px-lg-45 border-main br-4">
                <div class="d-flex flex-wrap w-100 pb-45">
                    <div class="d-flex justify-content-between align-items-end w-100">
                        <div class="flex-1 overflow-hidden">
                            <app-user-header [prop]="detailsData"></app-user-header>
                        </div>
                        <div class="d-flex flex-column align-items-end">
                            <app-forum-menu
                                [selectedItem]="detailsData"
                                forumType="recipe"
                                [enableTranslation]="
                                    detailsData?.allow_translation && (detailsData?.translations || []).length < 3
                                "
                                [enableEdit]="
                                    organizationId == detailsData?.organisation_id &&
                                    detailsData?.organisation_type === coffeeLabService.organization &&
                                    detailsData.user_id == authService.currentUser.id
                                "
                                [enableDelete]="
                                    organizationId == detailsData?.organisation_id &&
                                    detailsData?.organisation_type === coffeeLabService.organization &&
                                    detailsData.user_id == authService.currentUser.id
                                "
                            ></app-forum-menu>
                            <div
                                class="d-none d-md-block mt-2"
                                *ngIf="detailsData?.allow_translation && detailsData?.translations?.length > 0"
                            >
                                <app-translation-dropdown
                                    forumType="recipe"
                                    [translatedList]="detailsData?.translations"
                                ></app-translation-dropdown>
                            </div>
                        </div>
                    </div>
                    <div
                        class="w-100 d-block d-md-none mt-3 py-3 pr-0 border-top-main border-bottom-main"
                        *ngIf="detailsData?.allow_translation && detailsData?.translations?.length > 0"
                    >
                        <app-translation-dropdown
                            forumType="recipe"
                            [translatedList]="detailsData?.translations"
                        ></app-translation-dropdown>
                    </div>
                </div>
                <div class="pb-3 coffee-name">{{ detailsData?.name }}</div>
                <div class="pb-3 pb-md-4 pb-lg-45">
                    <img class="w-100 banner-image" [src]="detailsData?.cover_image_url" />
                    <div class="mt-3 expertise-level-block">
                        <div class="d-flex flex-column flex-md-row justify-content-md-around w-100">
                            <div class="pr-45 expert-sm">
                                <div class="m-0 d-flex">
                                    <span class="d-none d-md-block"
                                        ><img src="/assets/images/beginner-expertise.svg"
                                    /></span>
                                    <span class="d-md-none"
                                        ><img src="/assets/images/beginner-expertise-mb.svg"
                                    /></span>
                                    <div class="expertise pl-2">{{ 'expertise_level' | translate }}</div>
                                </div>
                                <div class="expertise-level m-0 d-flex">
                                    <span class="visibility-hidden"
                                        ><img src="/assets/images/beginner-expertise.svg"
                                    /></span>
                                    <div class="overflow-hidden pl-2 text-overflow-ellipsis text-capitalize">
                                        {{ detailsData?.expertise }}
                                    </div>
                                </div>
                            </div>
                            <div class="pr-45 preparation-sm">
                                <div class="m-0 d-flex">
                                    <span class="d-none d-md-block"><img src="/assets/images/p-time.svg" /></span>
                                    <span class="d-md-none"><img src="/assets/images/p-time-mb.svg" /></span>
                                    <div class="expertise pl-2">{{ 'brew_ratio' | translate }}</div>
                                </div>
                                <div class="expertise-level m-0 d-flex">
                                    <span class="visibility-hidden"
                                        ><img src="/assets/images/beginner-expertise.svg"
                                    /></span>
                                    <span class="pl-2"
                                        >{{ detailsData?.coffee_ratio }}:{{ detailsData?.water_ratio }}</span
                                    >
                                </div>
                            </div>
                            <div class="flex-wrap serving-sm">
                                <div class="m-0 d-flex">
                                    <span class="d-none d-md-block"><img src="/assets/images/serving.svg" /></span>
                                    <span class="d-md-none"><img src="/assets/images/serving-mb.svg" /></span>
                                    <div class="expertise pl-2">{{ 'serving' | translate }}</div>
                                </div>
                                <div class="expertise-level m-0 d-flex">
                                    <span class="visibility-hidden"><img src="/assets/images/serving.svg" /></span>
                                    <div class="pl-2">{{ detailsData?.serves }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="fnt-14 fnt-muli pt-3" [innerHTML]="detailsData?.description"></p>
                </div>
                <div class="ingredient-block">
                    <p class="m-0 fnt-14 fnt-muli fnt-bold text-clr334">{{ 'ingredients' | translate }}</p>
                    <div class="ingredient-details">
                        <div class="m-0" *ngFor="let ing of detailsData?.ingredients; let last = last">
                            <span class="d-flex justify-content-between">
                                <div class="name fnt-14 fnt-muli">{{ ing?.name }}</div>
                                <div class="qty fnt-14 fnt-muli fnt-bold">
                                    {{ ing?.quantity }} {{ ing?.quantity_unit }}
                                </div>
                            </span>
                            <div class="saprator" *ngIf="!last"></div>
                        </div>
                    </div>
                </div>
                <div *ngIf="detailsData.video_url" class="pt-3 pt-md-4 pt-lg-45">
                    <div class="fnt-14 fnt-muli fnt-bold text-clr334 mb-3">{{ 'see_recipe_video' | translate }}</div>
                    <video class="w-100" [src]="detailsData.video_url" controls></video>
                </div>
                <div class="directions pt-3 pt-md-4 pt-lg-45" *ngIf="detailsData?.steps && detailsData?.steps.length">
                    <p class="m-0 fnt-14 fnt-muli fnt-bold text-clr334 pb-3 pb-md-2">{{ 'directions' | translate }}</p>
                    <div *ngFor="let st of detailsData?.steps; index as i">
                        <p class="m-0 pb-1">{{ 'step' | translate }} {{ i + 1 }}:</p>
                        <p class="m-0 pb-2" [innerHTML]="st?.description"></p>
                        <span *ngIf="st.image_url"><img [src]="st.image_url" class="w-100 pb-3" /></span>
                    </div>
                </div>
                <div class="pt-4" *ngIf="detailsData?.original_details?.id">
                    <app-original-view [detailsData]="detailsData" forumType="recipe"></app-original-view>
                </div>
                <div class="pt-3 pt-md-4 pt-lg-45">
                    <app-comments
                        [commentData]="commentData"
                        [forumId]="detailsData?.id"
                        forumType="recipe"
                    ></app-comments>
                </div>
            </div>
        </article>
        <article class="col-12 col-lg-4 p-0 pl-lg-3 mt-4 mt-lg-0">
            <div class="">
                <div class="fnt-16 fnt-md-18 fnt-muli fnt-bold text-clr334 background-header">
                    {{ 'related_coffee_recipes' | translate }}
                </div>
                <div class="d-none d-lg-block">
                    <div *ngFor="let forum of relatedData" class="py-2">
                        <app-forum-card [data]="forum" forumType="recipe"></app-forum-card>
                    </div>
                </div>
                <div class="d-block d-lg-none pt-3">
                    <p-carousel [value]="relatedData" styleClass="p-carousel-forum" [numVisible]="1" [numScroll]="1">
                        <ng-template let-forum pTemplate="item">
                            <app-forum-card [data]="forum" forumType="recipe"></app-forum-card>
                        </ng-template>
                    </p-carousel>
                </div>
            </div>
        </article>
    </div>
</main>
<app-translate-toast [language]="detailsData?.lang_code"></app-translate-toast>
