<div class="mt-1 mt-lg-3 pb-4 pb-lg-5 w-fit-content" *ngIf="!isLoading">
    <a class="back-page" (click)="onBack()">
        <span class="ml-2">{{ 'back_to_forum' | translate }}</span>
    </a>
</div>

<div *ngIf="!isLoading" class="d-block d-lg-flex justify-content-between">
    <div class="pr-lg-2 flex-1 mb-4 col-md-7 col-12 pl-md-0 pl-0 pr-0 pr-md-3">
        <div class="border-question-view">
            <div class="d-flex justify-content-between p-3 pt-lg-4 px-lg-4">
                <div class="flex-1">
                    <app-user-header [prop]="detailsData"></app-user-header>
                </div>
                <div>
                    <app-forum-menu
                        [selectedItem]="detailsData"
                        forumType="question"
                        [enableSave]="false"
                        [enableEdit]="
                            detailsData.org_type === coffeeLabService.organization &&
                            detailsData.user_id == authService.currentUser.id
                        "
                        [enableDelete]="
                            detailsData.org_type === coffeeLabService.organization &&
                            detailsData.user_id == authService.currentUser.id
                        "
                        [enableStopPropagation]="false"
                    ></app-forum-menu>
                </div>
            </div>
            <div
                class="fnt-muli fnt-16 fnt-md-18 fnt-700 text-clr334 pb-4 px-md-4 px-3"
                [innerHTML]="detailsData.question"
            ></div>
            <app-like-divider [question]="detailsData"></app-like-divider>
            <div class="border-top-main py-4 px-0 px-md-45">
                <div class="d-flex justify-content-center ml-md-3">
                    <img
                        [src]="
                            authService.currentUser?.profile_image_thumb_url
                                ? authService.currentUser?.profile_image_thumb_url
                                : authService.currentUser?.profile_image_url || 'assets/images/default-avatar.png'
                        "
                        alt="avatar"
                        class="rounded-circle mt-1"
                        width="40"
                        height="40"
                    />
                    <div class="sewn-form-field width-comment mb-0">
                        <textarea
                            id="text-focus"
                            class="add-comment active-comment"
                            [ngClass]="{ 'comment-hgt': !comment }"
                            [(ngModel)]="comment"
                            [placeholder]="'add_a_comment' | translate"
                            pInputTextarea
                            autoResize="autoResize"
                        ></textarea>
                    </div>
                </div>

                <div
                    *ngIf="comment"
                    class="d-flex justify-content-between ml-35 mr-2 ml-md-0 mr-md-0 align-items-center mt-4"
                >
                    <p-checkbox
                        class="d-flex align-items-start ml-md-5"
                        [(ngModel)]="isAllowTranslation"
                        [binary]="true"
                        [label]="'allow_translations_by_other_authors' | translate"
                    ></p-checkbox>
                    <button (click)="onPost()" class="btn-raised">
                        {{ 'add_comment' | translate }}
                    </button>
                </div>
            </div>
            <div *ngIf="detailsData?.answers">
                <div
                    *ngFor="let answer of detailsData.answers; let last = last"
                    [id]="'answer-' + answer.id"
                    class="mb-35 mx-3 ml-md-5 mr-md-4 answer-wrapper"
                >
                    <div class="d-flex flex-wrap w-100 mt-35">
                        <div class="d-flex justify-content-between align-items-md-end w-100">
                            <app-user-header [prop]="answer"></app-user-header>
                            <div class="d-flex flex-column align-items-end icon-height">
                                <div>
                                    <app-forum-menu
                                        [selectedItem]="answer"
                                        forumType="answer"
                                        [extraInfo]="detailsData"
                                        [enableSave]="false"
                                        [enableEdit]="
                                            answer.org_type === coffeeLabService.organization &&
                                            answer.user_id == authService.currentUser.id
                                        "
                                        [enableDelete]="
                                            answer.org_type === coffeeLabService.organization &&
                                            answer.user_id == authService.currentUser.id
                                        "
                                        [enableTranslation]="
                                            answer?.allow_translation && answer?.translations?.length < 3
                                        "
                                        [enableStopPropagation]="false"
                                    ></app-forum-menu>
                                </div>
                                <div
                                    *ngIf="answer?.allow_translation && answer?.translations?.length"
                                    class="d-none d-md-block"
                                >
                                    <app-translation-dropdown
                                        forumType="question"
                                        [translatedList]="answer?.translations"
                                    ></app-translation-dropdown>
                                </div>
                            </div>
                        </div>
                        <div
                            *ngIf="answer?.allow_translation && answer?.translations?.length"
                            class="d-block d-md-none pt-3 text-center"
                        >
                            <app-translation-dropdown
                                forumType="question"
                                [translatedList]="answer?.translations"
                            ></app-translation-dropdown>
                        </div>
                    </div>
                    <div
                        class="fnt-muli fnt-14 text-clr334 lh-15 pt-md-4 pt-25 px-0"
                        [ngClass]="{ 'mb-2': !last }"
                        appFullImgWrapper
                        [innerHTML]="answer.answer"
                    ></div>
                    <div class="d-flex justify-content-between my-3 my-md-4">
                        <div class="d-flex">
                            <div class="d-flex align-like">
                                <div class="like-int">
                                    <img
                                        (click)="onLike(answer)"
                                        *ngIf="!answer.is_liked"
                                        class="cursor-point like"
                                        src="assets/images/thumbsup.svg"
                                        alt="thumbs-up"
                                    />
                                    <img
                                        (click)="onUnLike(answer)"
                                        *ngIf="answer.is_liked"
                                        class="cursor-point like"
                                        src="assets/images/thumbs-up-1.svg"
                                        alt="thumbs-up"
                                    />
                                </div>
                            </div>
                            <!-- <div class="align-items-center d-flex ml-0 hover-save-icon">
                                <img (click)="onFocus()" class="cursor-point" src="assets/images/save.svg" alt="save" />
                            </div> -->
                        </div>
                        <div class="d-flex hover-share-icon">
                            <img (click)="onShare()" class="cursor-point" src="assets/images/share.svg" alt="upload" />
                        </div>
                    </div>
                    <div
                        *ngIf="answerDetail && answerDetail?.original_answer_state === 'ACTIVE'"
                        class="border-main br-4 p-4 mb-4 d-none d-md-block w-100"
                    >
                        <div class="d-flex justify-content-between mb-4">
                            <div class="d-flex">
                                <img src="assets/images/qa-forum.svg" alt="question-image" />
                                <p
                                    class="
                                        align-items-center
                                        d-flex
                                        text-nowrap
                                        fnt-muli fnt-bold fnt-14
                                        text-clr334
                                        ml-2
                                    "
                                >
                                    {{ 'read_the_original_answer' | translate }}
                                </p>
                            </div>
                            <div class="bg-f8 px-25 py-2">
                                <p class="fnt-600 fnt-12 fnt-muli text-clr334">
                                    {{ 'original_language' | translate }} :
                                    {{ globalsService.getLanguage(answerDetail?.original_details?.language) }}
                                </p>
                            </div>
                        </div>
                        <app-user-header [prop]="answerDetail.original_details"></app-user-header>
                        <div class="flavour-profiles bg-f8 w-100 p-3 mt-35">
                            <a
                                class="fnt-14 fnt-600 fnt-muli"
                                [routerLink]="getLink(answerDetail?.original_details?.question_slug)"
                                [queryParams]="
                                    isAssignedToMe
                                        ? { isAssignedToMe: true }
                                        : isMyPost
                                        ? { isMyPost: true }
                                        : isSavedPost
                                        ? { isSavedPost: true }
                                        : ''
                                "
                                >{{ answerDetail?.original_details?.question | titlecase }}</a
                            >
                        </div>
                    </div>
                </div>
            </div>
            <button
                (click)="onFocusCommentBox()"
                class="cursor-point"
                class="
                    bg-transparent
                    border-0
                    fnt-14 fnt-bold fnt-muli
                    mb-4
                    ml-4 ml-md-5
                    pl-md-0
                    text-clr60b text-underline
                "
            >
                {{ 'write_comment' | translate }}
            </button>
        </div>
    </div>

    <div *ngIf="!isLoading" class="col-lg-5 px-0 pl-md-5">
        <app-join-community [detailType]="'question-detail'" [type]="'question'"></app-join-community>
    </div>
</div>

<div *ngIf="isLoading">
    <app-loading></app-loading>
</div>

<app-translate-toast [language]="detailsData?.lang_code"></app-translate-toast>
