<div class="main-block">
    <div class="mt-1 mt-lg-3 pb-4 pb-lg-5 w-fit-content" (click)="location.back()">
        <a class="back-page">
            <span class="ml-2">{{ 'back_to_forum' | translate }}</span>
        </a>
    </div>
    <div class="d-block d-md-flex">
        <div class="mt-1 mt-md-2 mb-4 mb-lg-5 pb-1">
            <h1 class="title-header text-clr334 fnt-700">{{ categoryName | titlecase }}</h1>
            <p class="text-clr334 col-md-8 pl-1 col-12">
                {{ 'coffee_roasting_is_the_process' | translate }}
            </p>
        </div>
        <div class="d-flex align-items-end language-drop mb-4 mb-md-0 mr-lg-4">
            <app-language-dropdown></app-language-dropdown>
        </div>
    </div>

    <p-tabView [(activeIndex)]="selectedTab" (onChange)="onChangeTab($event.index)">
        <p-tabPanel *ngFor="let menu of menuItems; let i = index" [selected]="selectedTab === i">
            <ng-template pTemplate="header">
                <img *ngIf="selectedTab !== i" [src]="menu.icon" alt="icon" />
                <img *ngIf="selectedTab === i" [src]="menu.activeIcon" alt="icon" />
                <span>{{ menu.label | translate }}</span>
            </ng-template>
            <div class="mt-45" *ngIf="selectedTab === 0">
                <div *ngIf="!isLoading" class="col-12 col-md-4 px-0 mx-auto w-min-content d-lg-none h-fit-content">
                    <div class="other-category py-4">
                        <div class="row mx-0 fnt-16 fnt-bold fnt-muli">
                            {{ 'other_categories' | translate }}
                        </div>
                        <div class="row mx-0 mt-4">
                            <div *ngFor="let item of otherCategories; let isLast = last" class="mr-md-25 mr-2">
                                <button
                                    class="category-btn fnt-600 text-clr334 mb-2"
                                    (click)="onCategoryClick(item.slug)"
                                >
                                    {{ item.name }}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="top-writer mb-4">
                        <div class="fnt-muli fnt-16 fnt-bold mb-2 mt-3">{{ 'top_writers' | translate }}</div>
                        <div
                            *ngFor="let user of topWriters; let isLast = last"
                            [ngClass]="{ 'border-0': isLast, 'mb-25': isLast }"
                            class="border-bottom mt-3 pb-3"
                        >
                            <app-user-header [isTopWriters]="true" [prop]="user"></app-user-header>
                        </div>
                    </div>
                </div>
                <div class="row mb-475 mb-md-0">
                    <ng-container *ngTemplateOutlet="filterDropdowns"></ng-container>
                </div>
                <div class="row">
                    <div class="col-12 col-md-7 px-0">
                        <div class="d-block ml-25 mr-25 ml-md-3 mr-md-0">
                            <div *ngIf="!isLoading">
                                <app-questions [questions]="questions"></app-questions>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="!isLoading && !questions?.length" class="text-center my-4 fnt-muli text-clr24">
                        <app-empty
                            [title]="'you_have_not_posted_anything_yet' | translate"
                            [description]="'no_any_posts_to_show_description' | translate"
                        ></app-empty>
                    </div>
                    <div
                        *ngIf="!isLoading"
                        class="col-12 col-md-4 px-0 mx-auto w-min-content d-none d-lg-block h-fit-content"
                    >
                        <div class="other-category py-4">
                            <div class="row mx-0 fnt-16 fnt-bold fnt-muli">
                                {{ 'other_categories' | translate }}
                            </div>
                            <div class="row mx-0 mt-4">
                                <div *ngFor="let item of otherCategories; let isLast = last" class="mr-md-25 mr-2">
                                    <button
                                        class="category-btn fnt-600 text-clr334 mb-2"
                                        (click)="onCategoryClick(item.slug)"
                                    >
                                        {{ item.name }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="top-writer mt-4">
                            <div class="fnt-muli fnt-16 fnt-bold mb-2 mt-3">{{ 'top_writers' | translate }}</div>
                            <div
                                *ngFor="let user of topWriters; let isLast = last"
                                [ngClass]="{ 'border-0': isLast, 'mb-25': isLast }"
                                class="border-bottom mt-3 pb-3"
                            >
                                <app-user-header [isTopWriters]="true" [prop]="user"></app-user-header>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-45" *ngIf="selectedTab === 1">
                <div class="row mb-475 mb-md-0">
                    <ng-container *ngTemplateOutlet="filterDropdowns"></ng-container>
                </div>
                <div *ngIf="!isLoading">
                    <app-articles [isSavedPost]="true" [articles]="articles"></app-articles>
                </div>

                <div *ngIf="!isLoading && !articles?.length" class="text-center my-4 fnt-muli text-clr334">
                    <app-empty
                        [title]="'you_have_not_saved_any_post' | translate"
                        [description]="'no_saved_posts_description' | translate"
                    ></app-empty>
                </div>
            </div>
            <div class="mt-45" *ngIf="selectedTab === 2">
                <div class="row mb-475 mb-md-0">
                    <ng-container *ngTemplateOutlet="filterDropdowns"></ng-container>
                </div>
                <div *ngIf="!isLoading">
                    <app-recipes [isSavedPost]="true" [recipes]="recipes"></app-recipes>
                </div>

                <div *ngIf="!isLoading && !recipes?.length" class="text-center my-4 fnt-muli text-clr24">
                    <app-empty
                        [title]="'you_have_not_saved_any_post' | translate"
                        [description]="'no_saved_posts_description' | translate"
                    ></app-empty>
                </div>
            </div>
        </p-tabPanel>
    </p-tabView>
</div>

<div *ngIf="isLoading">
    <app-loading></app-loading>
</div>

<ng-template #filterDropdowns>
    <div class="d-flex mb-md-4 ml-3">
        <div class="d-md-flex justify-content-md-between align-items-center pr-lg-2 flex-1">
            <div class="d-flex flex-md-row" [ngClass]="{ 'flex-column': selectedTab !== 0 }">
                <!-- <div>
                    <p-dropdown
                        [options]="categoryList"
                        (onChange)="getQuestions()"
                        [(ngModel)]="
                            selectedTab === 0
                                ? coffeeLabService.qaForumViewCategory
                                : selectedTab === 1
                                ? coffeeLabService.articleViewCategory
                                : coffeeLabService.recipeViewCategory
                        "
                        styleClass="round-border text-clr588"
                        [placeholder]="'category' | translate"
                        optionLabel="name"
                        optionValue="slug"
                        class="ml-0"
                        [showClear]="true"
                    ></p-dropdown>
                </div> -->
                <div class="mb-md-0 mb-3" *ngIf="selectedTab === 1">
                    <p-dropdown
                        [options]="translationsList"
                        optionLabel="label"
                        optionValue="value"
                        [(ngModel)]="coffeeLabService.articleViewFilterBy"
                        (onChange)="getArticles()"
                        placeholder="{{ 'translations_available' | translate }}"
                        styleClass="round-border"
                        [showClear]="true"
                    >
                    </p-dropdown>
                </div>
                <div class="mb-md-0 mb-3" *ngIf="selectedTab === 2">
                    <p-dropdown
                        [options]="translationsList"
                        optionLabel="label"
                        optionValue="value"
                        [(ngModel)]="coffeeLabService.recipeViewIsAvailableTranslation"
                        (onChange)="getRecipes()"
                        [placeholder]="'translation_available' | translate"
                        styleClass="round-border"
                        [showClear]="true"
                    >
                    </p-dropdown>
                </div>
                <div *ngIf="selectedTab === 0">
                    <p-dropdown
                        [options]="filterPostedByOptions"
                        optionLabel="label"
                        optionValue="value"
                        [(ngModel)]="coffeeLabService.qaForumViewFilterBy"
                        (onChange)="getQuestions()"
                        styleClass="round-border text-clr588"
                        [placeholder]="'posted_by' | translate"
                        [showClear]="true"
                    ></p-dropdown>
                </div>
                <div class="ml-md-3" [ngClass]="{ 'ml-3': selectedTab === 0 }">
                    <p-dropdown
                        [options]="sortOptions"
                        [(ngModel)]="
                            selectedTab === 0
                                ? coffeeLabService.qaForumViewSortBy
                                : selectedTab === 1
                                ? coffeeLabService.articleViewFilterBy
                                : coffeeLabService.recipeViewSortBy
                        "
                        (onChange)="getQuestions()"
                        [placeholder]="'sort_by' | translate"
                        styleClass="round-border text-clr588"
                        optionLabel="label"
                        optionValue="value"
                        [showClear]="true"
                    ></p-dropdown>
                </div>
            </div>
        </div>
        <div class="d-none d-lg-block empty-join-wrapper pl-lg-2"></div>
    </div>
</ng-template>
