<div class="main-block">
    <div class="mb-3">
        <div>
            <p-breadcrumb [model]="breadCrumbItem" class="w-100"></p-breadcrumb>
        </div>
    </div>
    <div [formGroup]="productForm" (ngSubmit)="onSave()" novalidate>
        <div class="row gutter-16 gutter-lg-24 productDiv">
            <div class="col-12 col-sm-12 col-md-6 d-flex align-items-center">
                <span class="fnt-16 fnt-md-18 fnt-700 fnt-muli black w-100 productLineDiv" *ngIf="productName === ''">
                    {{ 'add_new_product' | translate }}
                </span>
                <span class="fnt-16 fnt-md-18 fnt-700 fnt-muli black w-100 productLineDiv" *ngIf="productName !== ''">{{
                    productName | titlecase
                }}</span>
            </div>
            <div *ngIf="productID" class="col-12 col-sm-12 col-md-6 d-none d-sm-none d-md-block">
                <div class="float-right">
                    <span class="primary_txt pr-3">{{ 'product_visibility' | translate }} : </span>
                    <div class="btn-group toggleDiv">
                        <div
                            class="btn disbableBtn"
                            [ngClass]="productForm['controls']['is_public']['value'] ? 'enableBtn' : ''"
                            id="activeStatus"
                            (click)="togglePublic(true)"
                        >
                            {{ 'public' | translate }}
                        </div>
                        <div
                            class="btn disbableBtn"
                            (click)="togglePublic(false)"
                            [ngClass]="!productForm['controls']['is_public']['value'] ? 'enableBtn' : ''"
                            id="disableStatus"
                        >
                            {{ 'private' | translate }}
                        </div>
                    </div>
                </div>
            </div>
            <div
                *ngIf="productID"
                class="col-12 col-sm-12 col-md-12 row d-flex d-sm-flex d-md-none pt-4 row gutter-16 gutter-lg-24"
            >
                <div class="col-6 d-flex align-items-center">
                    <span class="primary_txt fnt-14">{{ 'product_visibility' | translate }} : </span>
                </div>
                <div class="col-6 p-0">
                    <div class="btn-group toggleDiv float-right">
                        <div
                            class="btn disbableBtn"
                            [ngClass]="productForm['controls']['is_public']['value'] ? 'enableBtn' : ''"
                            id="activeStatus"
                            (click)="togglePublic(true)"
                        >
                            {{ 'public' | translate }}
                        </div>
                        <div
                            class="btn disbableBtn"
                            (click)="togglePublic(false)"
                            [ngClass]="!productForm['controls']['is_public']['value'] ? 'enableBtn' : ''"
                            id="disableStatus"
                        >
                            {{ 'private' | translate }}
                        </div>
                    </div>
                </div>
                <div class="col-12 divSeperator w-100 ml-1 mt-4"></div>
            </div>
        </div>
        <div class="row gutter-16 gutter-lg-24 mt-3 mt-md-2">
            <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 sewn-form-field w-100">
                <label>{{ 'product_name' | translate }}<span class="star">*</span></label>
                <input
                    type="text"
                    [placeholder]="'product_name' | translate"
                    formControlName="name"
                    (input)="productNameValue($event)"
                    pInputText
                />
                <small *ngIf="productForm.controls['name'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
            <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                <label>{{ 'product_eligible_for' | translate }}<span class="star">*</span></label>
                <p-dropdown
                    [options]="eligibleArray"
                    optionLabel="label"
                    [placeholder]="'select_subscription_type' | translate"
                    [style]="{ width: '100%' }"
                    formControlName="purchase_type"
                    optionValue="value"
                ></p-dropdown>
                <small *ngIf="productForm.controls['purchase_type'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
        </div>
        <div class="row gutter-16 gutter-lg-24 mt-2">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-6 sewn-form-field w-100 describePadding">
                <div>
                    <label>{{ 'product_description' | translate }}<span class="star">*</span></label>
                    <label class="float-right limitFont">{{ productDescriptionLength }}/50 words</label>
                </div>
                <textarea
                    type="text"
                    class="descriptionText-area"
                    [placeholder]="'tell_about_product' | translate"
                    formControlName="description"
                    (keydown)="onPasteDescription('description')"
                    (input)="onPasteDescription('description')"
                    pInputText
                ></textarea>
                <small *ngIf="productForm.controls['description'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
        </div>
        <div class="divSeperator"></div>
        <div class="row no-gutters mb-4">
            <div class="col-12 mb-2 mb-md-3">
                <span class="primary_txt fnt-14 fnt-md-16">{{ 'variants' | translate }}</span>
            </div>
            <div class="col-12 col-sm-12 col-md-8 col-lg-8 col-xl-8 d-flex align-items-center mb-3 mb-md-0 varientBox">
                <p-checkbox
                    formControlName="is_variants_included"
                    binary="true"
                    (onChange)="createTypeVariantArray()"
                    label="If this product has options like roasted coffee batch, flavour profile, availability etc."
                >
                </p-checkbox>
            </div>
            <div
                *ngIf="productForm['value']['is_variants_included']"
                class="col-12 col-sm-12 col-md-6 col-lg-4 col-xl-4 d-none d-sm-none d-md-block"
            >
                <div class="pull-right addNewWeightDiv variant-pos leftPos">
                    <img class="mb-1" src="assets/images/add_grey.svg" />
                    <span class="ml-2 fnt-muli fnt-700 fnt-14 text-clr334 cursor-pointer" (click)="addNewVarients()">
                        {{ 'add_new_variant' | translate }}
                    </span>
                </div>
            </div>
        </div>
        <div
            *ngIf="productForm['value']['is_variants_included']"
            class="col-12 weight-varient-array d-flex d-sm-flex d-md-none p-0"
        >
            <p-dropdown
                [options]="variantTypeArray"
                optionLabel="label"
                [placeholder]="'select_variant' | translate"
                class="w-100"
                [style]="{ width: '100%' }"
                [(ngModel)]="currentVariant"
                [ngModelOptions]="{ standalone: true }"
                optionValue="value"
            >
                <ng-template let-weight pTemplate="item">
                    <span *ngIf="weight.label">{{ weight.label }}</span>
                    <span *ngIf="!weight.label" class="weightVariantBtn">
                        <img class="" src="assets/images/add_grey.svg" />
                        <span
                            class="ml-2 fnt-muli fnt-700 fnt-14 text-highlited cursor-pointer"
                            (click)="addNewVarients()"
                        >
                            {{ 'add_variant' | translate }}
                        </span>
                    </span>
                </ng-template>
            </p-dropdown>
        </div>
        <div
            class="col-12 col-sm-12 col-md-1 col-lg-1 col-xl-1 delete-varient sewn-form-field pl-md-0 pl-lg-2 delete-weight-varient-mb checkBoxDiv"
            *ngIf="productForm['value']['is_variants_included']"
        >
            <span class="fnt-700 editBtn cursor-pointer align-items-center" (click)="removeVarientDrop(currentVariant)">
                {{ 'delete_variant' | translate }}
            </span>
        </div>
        <div
            class="pt-lg-0"
            [ngClass]="{
                isProductOption: !productForm['value']['is_variants_included'],
                'pt-md-3': productForm['value']['is_variants_included']
            }"
            *ngIf="productForm?.controls?.varients?.controls"
        >
            <p-tabView [(activeIndex)]="currentVariant">
                <p-tabPanel
                    formArrayName="varients"
                    *ngFor="let varient of productForm.controls['varients']['controls']; let i = index; last as isLast"
                >
                    <ng-template pTemplate="header">
                        <span
                            >{{ varient['value']['varient_name'] }}
                            <span (click)="removeVarient(i)"
                                ><img src="assets/images/delete-varient-name.svg" alt="delete" /></span
                        ></span>
                    </ng-template>
                    <div [formGroupName]="i">
                        <div class="row gutter-16 gutter-lg-24 mt-4">
                            <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 sewn-form-field w-100">
                                <label>{{ 'select_roasted_batch' | translate }}<span class="star">*</span></label>
                                <p-dropdown
                                    [options]="roastedBatches"
                                    optionLabel="roast_batch_name"
                                    [placeholder]="'select_batch' | translate"
                                    [style]="{ width: '100%' }"
                                    formControlName="rc_batch_id"
                                    optionValue="id"
                                    (onChange)="onBatchChange(i)"
                                ></p-dropdown>
                                <small *ngIf="varient['controls']['rc_batch_id'].errors?.required" class="p-error">
                                    {{ 'required' | translate }}
                                </small>
                            </div>
                            <div
                                class="col-md-6 col-lg-6 sewn-form-field w-100 d-xl-none d-lg-block d-md-block d-sm-none d-none"
                            ></div>

                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'roaster_ref_no' | translate }}</label>
                                <input type="text" readonly formControlName="roaster_ref_no" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'batch_ref_no' | translate }}</label>
                                <input type="text" readonly formControlName="batch_ref_no" pInputText />
                            </div>
                        </div>
                        <div class="row gutter-16 gutter-lg-24">
                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'roaster_profile' | translate }}</label>
                                <input type="text" readonly formControlName="roasting_profile_name" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'roaster_level' | translate }}<span class="star">*</span></label>
                                <input type="text" readonly formControlName="roast_level" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'roasting_time' | translate }}</label>
                                <input type="text" readonly formControlName="roast_time" pInputText />
                            </div>
                        </div>
                        <div class="row gutter-16 gutter-lg-24 mt-lg-2 e-comm-border-top pl-0 pr-0">
                            <div class="col-12 mb-3 mt-3 mt-md-0">
                                <span class="primary_txt fnt-14 fnt-md-16">{{ 'details_estate' | translate }}</span>
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'estate_name' | translate }}</label>
                                <input type="text" readonly formControlName="estate_name" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'origin' | translate }}</label>
                                <input type="text" readonly formControlName="origin" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'region' | translate }}</label>
                                <input type="text" readonly formControlName="region" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'harvest_year' | translate }}</label>
                                <input type="text" readonly formControlName="harvest_year" pInputText />
                            </div>
                        </div>
                        <div class="row gutter-16 gutter-lg-24 e-comm-border-top pl-0 pr-0">
                            <div class="col-12 mb-3 mt-3 mt-md-0">
                                <span class="primary_txt fnt-14 fnt-md-16">{{ 'tasting_notes' | translate }}</span>
                            </div>
                            <div class="col-sm-12 col-md-4 col-lg-4 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'body' | translate }}</label>
                                <input type="text" readonly formControlName="body" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-4 col-lg-4 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'acidity' | translate }}</label>
                                <input type="text" readonly formControlName="acidity" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-4 col-lg-4 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'aroma' | translate }}</label>
                                <input type="text" readonly formControlName="aroma" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-4 col-lg-4 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'flavour' | translate }}</label>
                                <input type="text" readonly formControlName="flavour" pInputText />
                            </div>
                            <div class="col-sm-12 col-md-4 col-lg-4 col-xl-3 sewn-form-field w-100">
                                <label>{{ 'processing' | translate }}</label>
                                <input type="text" readonly formControlName="processing" pInputText />
                            </div>
                        </div>
                        <div class="row gutter-16 gutter-lg-24 e-comm-border-top">
                            <div
                                class="col-12 col-sm-12 col-md-12 sewn-form-field w-100 pl-md-2 pr-md-3 pl-0 pr-0 mb-0 mt-2"
                            >
                                <label class="m-0">{{ 'flavour_profile' | translate }}</label>
                                <div>
                                    <span
                                        class="flavour-item d-inline-block"
                                        *ngFor="let flavour of varient['controls']['flavour_profile']['value']"
                                    >
                                        {{ flavour.flavour_profile_name }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="row gutter-16 gutter-lg-24">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-6 sewn-form-field w-100">
                                <label>{{ 'roaster_notes' | translate }}</label>
                                <textarea
                                    type="text"
                                    class="roasterDivText-area"
                                    placeholder=""
                                    readonly
                                    formControlName="roaster_notes"
                                    pInputText
                                ></textarea>
                            </div>
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-6 sewn-form-field w-100">
                                <div>
                                    <label>{{ 'recipes' }}</label>
                                    <label class="float-right limitFont">{{ recipeTextLength }}/50 words</label>
                                </div>

                                <textarea
                                    type="text"
                                    class="roasterDivText-area"
                                    [placeholder]="'add_recipe_customer' | translate"
                                    formControlName="recipes"
                                    (keydown)="onPasteDescription('recipes', i)"
                                    (input)="onPasteDescription('recipes', i)"
                                    pInputText
                                ></textarea>
                            </div>
                        </div>
                        <div class="row gutter-16 gutter-lg-24 e-comm-border-top pl-0 pr-0 pt-2">
                            <div class="col-12 mb-3 mt-3">
                                <span class="primary_txt fnt-14 fnt-md-16">{{
                                    'recommended_brewing_method' | translate
                                }}</span>
                            </div>
                            <div class="col-sm-12 col-md-4 col-lg-5 col-xl-3 sewn-form-field w-100">
                                <label class="text-nowrap"
                                    >{{ 'select_brewing_method' | translate }}<span class="star">*</span></label
                                >
                                <p-dropdown
                                    [options]="brewingMethodArray"
                                    optionLabel="label"
                                    [placeholder]="'select_method' | translate"
                                    [style]="{ width: '100%' }"
                                    formControlName="brewing_method"
                                    optionValue="value"
                                >
                                </p-dropdown>
                                <small *ngIf="varient['controls']['brewing_method'].errors?.required" class="p-error">
                                    {{ 'required' | translate }}
                                </small>
                            </div>
                            <div class="col-12 col-sm-12 col-md-8 col-lg-7 col-xl-6 sewn-form-field w-100">
                                <div>
                                    <label>{{ 'recommendation_text' | translate }}<span class="star">*</span></label>
                                    <label class="float-right limitFont">{{ recommendationTextLength }}/10 words</label>
                                </div>
                                <input
                                    type="text"
                                    class="d-none d-sm-none d-md-block d-lg-block d-xl-block"
                                    (keydown)="onPasteDescription('recommendation', i)"
                                    (input)="onPasteDescription('recommendation', i)"
                                    formControlName="roaster_recommendation"
                                    pInputText
                                />
                                <textarea
                                    type="text"
                                    class="descriptionText-area d-block d-sm-block d-md-none d-lg-none d-xl-none"
                                    formControlName="roaster_recommendation"
                                    (keydown)="onPasteDescription('recommendation', i)"
                                    (input)="onPasteDescription('recommendation', i)"
                                    pInputText
                                ></textarea>
                                <small
                                    *ngIf="varient['controls']['roaster_recommendation'].errors?.required"
                                    class="p-error"
                                >
                                    {{ 'required' | translate }}
                                </small>
                            </div>
                        </div>
                        <div class="divSeperator"></div>
                        <div class="row gutter-16 gutter-lg-24">
                            <div class="col-12">
                                <app-varient-details
                                    #cmp
                                    [varientDetails]="varient"
                                    (onWeightCreate)="onWeightCreate($event)"
                                    (onWeightDelete)="onWeightDelete($event)"
                                ></app-varient-details>
                            </div>
                        </div>
                        <div class="divSeperator"></div>
                    </div>
                </p-tabPanel>
            </p-tabView>
        </div>
        <div class="col-12 p-0 mb-3">
            <span class="primary_txt fnt-14 fnt-md-16">{{ 'boxes_details' | translate }}</span
            ><br />
            <span>{{ 'add_value_crate' | translate }}</span>
        </div>
        <div
            formArrayName="crates"
            *ngFor="let box of productForm.controls['crates']['controls']; let i = index; last as isLast"
            class="mt-4"
        >
            <div [formGroupName]="i" class="row mt-2">
                <div class="d-flex width-mob">
                    <div class="sewn-form-field w-100 pr-0 bags-width ml-3">
                        <label class="text-nowrap">{{ 'box_value' | translate }}</label>
                        <input type="text" placeholder="" readonly formControlName="boxField" pInputText />
                    </div>
                    <div class="equal-operators">=</div>
                </div>
                <div class="sewn-form-field w-100 pl-0 pr-0 boxCrateWidth boxCreatedMobile">
                    <label>{{ 'weight' | translate }}</label>
                    <input type="text" readonly placeholder="" formControlName="weight_name" pInputText />
                </div>
                <div class="equal-operators pl-2 pr-2">x</div>
                <div class="sewn-form-field w-100 pl-0 boxCrateWidth">
                    <label class="d-none d-sm-none d-md-block"
                        >{{ 'number_of_bags' | translate }}<span class="star">*</span></label
                    >
                    <label class="d-block d-sm-block d-md-none"
                        >{{ 'no_of_bags' | translate }}<span class="star">*</span></label
                    >
                    <input type="number" placeholder="" formControlName="crate_capacity" pInputText />
                    <small *ngIf="box.controls['crate_capacity'].errors?.required" class="p-error">
                        {{ 'required' | translate }}
                    </small>
                </div>
            </div>
        </div>
        <div class="divSeperator"></div>
        <div class="row gutter-16 gutter-lg-24 mt-4">
            <div class="col-12 mb-3">
                <span class="primary_txt fnt-14 fnt-md-16">{{ 'vat_details' | translate }}</span
                ><br />
            </div>
            <div class="col-12 col-sm-12 col-md-4 col-lg-6 col-xl-3 sewn-form-field w-100">
                <label>{{ 'select_vat_type' }}<span class="star">*</span></label>
                <p-dropdown
                    [options]="vatSettings"
                    optionLabel="label"
                    [placeholder]="'select_subscription_type' | translate"
                    [style]="{ width: '100%' }"
                    formControlName="vat_setting_id"
                    optionValue="value"
                ></p-dropdown>
                <small *ngIf="productForm.controls['vat_setting_id'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
            <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-3 sewn-form-field w-100 pl-md-4">
                <label class="fnt-14 fnt-600 fnt-muli txt-clr-554"
                    >{{ 'is_product_price_vat' | translate }}<span class="star">*</span></label
                >
                <p-checkbox
                    formControlName="is_price_including_vat"
                    binary="true"
                    class="mt-1"
                    [label]="'price_inclusive_vat' | translate"
                >
                </p-checkbox>
            </div>
        </div>
        <div class="row gutter-16 gutter-lg-24 mt-4 d-none d-sm-none d-md-flex">
            <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                <button type="button" class="btn btn-stroked" (click)="onCancel()">{{ 'cancel' | translate }}</button>
                <button type="submit" class="btn btn-raised ml-3" (click)="onSave()">{{ 'save' | translate }}</button>
            </div>
            <div *ngIf="!productID" class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                <button type="button" class="btn btn-raised pull-right" (click)="togglePublic(true)">
                    {{ 'publish' | translate }}
                </button>
            </div>
        </div>
        <div class="row gutter-16 gutter-lg-24 mt-4 d-block d-sm-block d-md-none">
            <div *ngIf="!productID" class="col-12 col-sm-12">
                <button type="button" class="btn btn-raised w-100" (click)="togglePublic(true)">
                    {{ 'publish' | translate }}
                </button>
            </div>
            <div class="col-12 col-sm-12 mt-3">
                <button type="submit" class="btn btn-raised w-100" (click)="onSave()">{{ 'save' | translate }}</button>
            </div>
            <div class="col-12 col-sm-12 mt-3">
                <button type="button" class="btn btn-stroked w-100" (click)="onCancel()">
                    {{ 'cancel' | translate }}
                </button>
            </div>
        </div>
    </div>
</div>
