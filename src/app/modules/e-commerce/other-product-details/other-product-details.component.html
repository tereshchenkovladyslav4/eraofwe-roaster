<div class="main-block">
    <div class="mb-3">
        <div>
            <p-breadcrumb [model]="breadCrumbItem" class="w-100"></p-breadcrumb>
        </div>
    </div>
    <div [formGroup]="productForm" (ngSubmit)="uploadImages()" novalidate>
        <div class="d-flex flex-column flex-md-row justify-content-md-between">
            <span class="fnt-16 fnt-md-18 fnt-700 fnt-muli fnt-clr334">
                {{ (productName | titlecase) || ('add_new_product' | translate) }}
            </span>
            <div *ngIf="productID" class="">
                <p-divider type="dashed" styleClass="d-block d-md-none"></p-divider>
                <div class="pt-3 pt-md-0 d-flex justify-content-between align-items-center">
                    <span class="fnt-muli fnt-14 fnt-md-18 fnt-bold text-clr334 pr-2"
                        >{{ 'product_visibility' | translate }} :</span
                    >
                    <p-selectButton
                        [options]="visibilityOptions"
                        formControlName="is_public"
                        optionLabel="label"
                        optionValue="value"
                        (onChange)="onSave()"
                        styleClass="p-selectbutton-prebook"
                    ></p-selectButton>
                </div>
                <p-divider type="dashed" styleClass="d-block d-md-none"></p-divider>
            </div>
        </div>
        <div class="row gutter-16 gutter-lg-24 mt-3 mt-md-35">
            <div class="col-12 col-md-6 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'product_name' | translate }}<span class="star">*</span></label>
                <input
                    type="text"
                    [placeholder]="'product_name' | translate"
                    formControlName="name"
                    (input)="productNameValue($event)"
                    pInputText
                />
                <small *ngIf="productForm.controls['name'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
            <div class="col-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'product_is_for' | translate }}<span class="star">*</span></label>
                <p-dropdown
                    [options]="businessTypeList"
                    optionLabel="label"
                    formControlName="business_type"
                    optionValue="value"
                    [autoDisplayFirst]="false"
                ></p-dropdown>
                <small *ngIf="productForm.controls['business_type'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
            <div class="col-12 col-md-6 col-lg-3 d-none d-lg-block sewn-form-field"></div>
            <div class="col-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'manufacturer_name' | translate }}<span class="star">*</span></label>
                <input
                    type="text"
                    [placeholder]="'manufacturer_name' | translate"
                    formControlName="manufacturer_name"
                    pInputText
                />
                <small *ngIf="productForm.controls['manufacturer_name'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
            <div class="col-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'model_number' | translate }}</label>
                <input
                    type="text"
                    [placeholder]="'model_number' | translate"
                    formControlName="model_number"
                    pInputText
                />
            </div>
            <div class="col-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'supplier_name' | translate }}</label>
                <p-dropdown
                    [options]="supplierList"
                    optionLabel="label"
                    formControlName="business_type"
                    optionValue="value"
                >
                    <ng-template let-supplier pTemplate="item">
                        <span *ngIf="supplier.label">{{ supplier.label }}</span>
                    </ng-template>
                </p-dropdown>
            </div>
            <div class="col-12 col-lg-6 sewn-form-field">
                <div>
                    <label>{{ 'product_description' | translate }}<span class="star">*</span></label>
                    <label class="float-right limitFont"
                        >{{ productForm.get('description').value | wordCount }}/300 {{ 'words' | translate }}</label
                    >
                </div>
                <textarea
                    type="text"
                    [placeholder]="'tell_about_product' | translate"
                    formControlName="description"
                    [rows]="3"
                    pInputText
                ></textarea>
                <small *ngIf="productForm.controls['description'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
                <small *ngIf="productForm.controls['description'].errors?.maxWordCount" class="p-error">
                    Please input 300 words
                </small>
            </div>
        </div>
        <p-divider type="dashed" styleClass="mt-2 mb-4 mt-lg-4 mb-lg-475"></p-divider>
        <div class="row gutter-16 gutter-lg-24">
            <div class="col-12 mb-3 mb-lg-4">
                <span class="primary_txt fnt-16">{{ 'product_details' | translate }}</span>
            </div>
            <div class="col-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'price' | translate }}<span class="star">*</span></label>
                <div class="p-input-icon-left">
                    <input type="number" formControlName="price" pInputText />
                    <span class="left-icon fnt-muli fnt-14 fnt-normal text-clr334 lh-normal">SEK</span>
                    <small *ngIf="productForm.controls['price'].errors?.required" class="position-absolute p-error">
                        {{ 'required' | translate }}
                    </small>
                </div>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'stock_available' | translate }}<span class="star">*</span></label>
                <div class="p-input-icon-right">
                    <input type="number" pInputText formControlName="available_quantity" />
                    <span class="right-icon fnt-muli fnt-14 fnt-normal text-clr334 lh-normal">{{
                        productForm.value.available_quantity_type
                    }}</span>
                    <small
                        *ngIf="productForm.controls['available_quantity'].errors?.required"
                        class="position-absolute p-error"
                    >
                        {{ 'required' | translate }}
                    </small>
                </div>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'status' | translate }}<span class="star">*</span></label>
                <p-dropdown
                    [options]="statusList"
                    optionLabel="label"
                    styleClass="w-100"
                    formControlName="status"
                    optionValue="value"
                    [autoDisplayFirst]="false"
                ></p-dropdown>
                <small *ngIf="productForm.controls['status'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'sku_number' | translate }}<span class="star">*</span></label>
                <input type="text" formControlName="sku_number" pInputText />
                <small *ngIf="productForm.controls['sku_number'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
        </div>
        <div class="row gutter-16 gutter-lg-24 mt-lg-2">
            <div class="col-12 mb-3 mb-lg-4">
                <span class="primary_txt fnt-16">{{ 'product_dimensions' | translate }}</span>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'length' | translate }}</label>
                <div class="input-and-select gray">
                    <input
                        type="number"
                        pInputText
                        formControlName="length"
                        [placeholder]="'enter_number' | translate"
                    />
                    <p-dropdown
                        [options]="lengthUnitList"
                        optionLabel="label"
                        placeholder=""
                        formControlName="length_unit"
                        optionValue="value"
                    ></p-dropdown>
                    <small *ngIf="productForm.controls['length'].errors?.required" class="position-absolute p-error">
                        {{ 'required' | translate }}
                    </small>
                </div>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'width' | translate }}</label>
                <div class="input-and-select gray">
                    <input
                        type="number"
                        pInputText
                        formControlName="width"
                        [placeholder]="'enter_number' | translate"
                    />
                    <p-dropdown
                        [options]="lengthUnitList"
                        optionLabel="label"
                        formControlName="width_unit"
                        optionValue="value"
                    ></p-dropdown>
                    <small *ngIf="productForm.controls['width'].errors?.required" class="position-absolute p-error">
                        {{ 'required' | translate }}
                    </small>
                </div>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'height' | translate }}</label>
                <div class="input-and-select gray">
                    <input
                        type="number"
                        pInputText
                        formControlName="height"
                        [placeholder]="'enter_number' | translate"
                    />
                    <p-dropdown
                        [options]="lengthUnitList"
                        optionLabel="label"
                        placeholder=""
                        formControlName="height_unit"
                        optionValue="value"
                    ></p-dropdown>
                    <small *ngIf="productForm.controls['height'].errors?.required" class="position-absolute p-error">
                        {{ 'required' | translate }}
                    </small>
                </div>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                <label>{{ 'weight' | translate }}</label>
                <div class="p-input-icon-right">
                    <input
                        type="number"
                        pInputText
                        formControlName="weight"
                        [placeholder]="'enter_number' | translate"
                    />
                    <span class="right-icon fnt-muli fnt-14 fnt-normal text-clr334 lh-normal">kg</span>
                </div>
            </div>
        </div>
        <p-divider type="dashed" class="col-12 p-0" styleClass="mt-3 mb-4 d-md-none"></p-divider>
        <div class="mt-lg-2">
            <div class="fnt-16 fnt-muli fnt-700 text-clr334 mb-3">
                {{ 'upload_product_images' | translate }}<span class="star">*</span>
            </div>
            <div class="row gutter-16 flex-nowrap overflow-auto">
                <div class="col">
                    <label class="text-nowrap"
                        >{{ ((isMobile$ | async) ? 'feature_image' : 'upload_feature_image') | translate
                        }}<span class="star">*</span></label
                    >
                    <div
                        *ngIf="!productForm?.value?.fileDetails"
                        class="addImageContainer d-flex align-items-center justify-content-center"
                    >
                        <label class="d-flex align-items-center justify-content-center pointer-item">
                            <input
                                type="file"
                                accept="image/png, image/jpeg"
                                style="display: none"
                                #featureImage
                                (change)="handleImageFile($event, 0, 'featured_image')"
                            />
                            <div class="d-flex flex-wrap align-items-center justify-content-center empty-image-wrapper">
                                <img src="assets/images/upload_icon.svg" />
                                <span class="d-none d-sm-none d-md-block secondary_txt text-clrab mt-2 px-1">{{
                                    'drag_drop_image' | translate
                                }}</span>
                            </div>
                        </label>
                    </div>

                    <div *ngIf="productForm?.value?.fileDetails" class="addImageContainer">
                        <img [src]="productForm?.value?.fileDetails?.image_url" alt="" class="uploadImg" />
                        <div class="imageLabel fnt-muli fnt-14 fnt-bold lh-normal text-white">
                            <span class="ellipsis">
                                {{ trackFileName(productForm?.value?.fileDetails?.image_url) }}
                            </span>
                            <i class="pi pi-ellipsis-v cursor-pointer" (click)="opMd.toggle($event)"></i>
                        </div>
                        <p-overlayPanel #opMd styleClass="p-overlaypanel-actions" appendTo="body">
                            <ng-template pTemplate>
                                <div
                                    class="fnt-muli fnt-14 fnt-600 text-clr588 action-item cursor-pointer"
                                    (click)="deleteImage(0, 'featured_image')"
                                >
                                    Delete
                                </div>
                            </ng-template>
                        </p-overlayPanel>
                    </div>
                </div>
                <div class="col" *ngFor="let product_image of productForm?.value?.product_images; let m = index">
                    <label>{{ 'product_images' | translate }}</label>
                    <div
                        *ngIf="!product_image['fileDetails']"
                        class="addImageContainer d-flex align-items-center justify-content-center"
                    >
                        <label class="d-flex align-items-center justify-content-center pointer-item">
                            <input
                                type="file"
                                accept="image/png, image/jpeg"
                                style="display: none"
                                #featureImage
                                (change)="handleImageFile($event, m, 'product_images')"
                            />
                            <div class="d-flex flex-wrap align-items-center justify-content-center empty-image-wrapper">
                                <img src="assets/images/upload_icon.svg" />
                                <span class="d-none d-sm-none d-md-block secondary_txt text-clrab mt-2 px-1">{{
                                    'drag_drop_image' | translate
                                }}</span>
                            </div>
                        </label>
                    </div>
                    <div *ngIf="product_image['fileDetails']" class="addImageContainer">
                        <img [src]="product_image['fileDetails']['image_url']" alt="" class="uploadImg" />
                        <div class="imageLabel fnt-muli fnt-14 fnt-bold lh-normal text-white">
                            <span class="ellipsis">
                                {{ trackFileName(product_image['fileDetails']['image_url']) }}
                            </span>
                            <i class="pi pi-ellipsis-v cursor-pointer" (click)="opMd.toggle($event)"></i>
                        </div>
                        <p-overlayPanel #opMd styleClass="p-overlaypanel-actions" appendTo="body">
                            <ng-template pTemplate>
                                <div
                                    class="fnt-muli fnt-14 fnt-600 text-clr588 action-item cursor-pointer"
                                    (click)="deleteImage(m, 'product_images')"
                                >
                                    Delete
                                </div>
                            </ng-template>
                        </p-overlayPanel>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-4 mt-lg-45">
            <label>{{ 'product_use_images' | translate }}</label>
            <div class="row gutter-16 overflow-auto" [ngClass]="{ 'flex-nowrap': !(isMobile$ | async) }">
                <div
                    class="useImageContainer mb-3 mb-md-0"
                    [ngClass]="(isMobile$ | async) ? 'col-12' : 'col'"
                    *ngFor="let product_image of productForm?.value?.product_use_images; let m = index"
                >
                    <div
                        *ngIf="!product_image['fileDetails']"
                        class="addImageContainer d-flex align-items-center justify-content-center"
                    >
                        <label class="d-flex align-items-center justify-content-center pointer-item">
                            <input
                                type="file"
                                accept="image/png, image/jpeg"
                                style="display: none"
                                #featureImage
                                (change)="handleImageFile($event, m, 'product_use_images')"
                            />
                            <div class="d-flex flex-wrap align-items-center justify-content-center empty-image-wrapper">
                                <img src="assets/images/upload_icon.svg" />
                                <span class="secondary_txt text-clrab mt-2 px-1">{{
                                    'drag_drop_image' | translate
                                }}</span>
                            </div>
                        </label>
                    </div>
                    <div *ngIf="product_image['fileDetails']" class="addImageContainer">
                        <img [src]="product_image['fileDetails']['image_url']" alt="" class="uploadImg" />
                        <div class="imageLabel fnt-muli fnt-14 fnt-bold lh-normal text-white">
                            <span class="ellipsis">
                                {{ trackFileName(product_image['fileDetails']['image_url']) }}
                            </span>
                            <i class="pi pi-ellipsis-v cursor-pointer" (click)="opMd.toggle($event)"></i>
                        </div>
                        <p-overlayPanel #opMd styleClass="p-overlaypanel-actions" appendTo="body">
                            <ng-template pTemplate>
                                <div
                                    class="fnt-muli fnt-14 fnt-600 text-clr588 action-item cursor-pointer"
                                    (click)="deleteImage(m, 'product_use_images')"
                                >
                                    Delete
                                </div>
                            </ng-template>
                        </p-overlayPanel>
                    </div>
                </div>
                <div class="col d-none d-lg-block"></div>
            </div>
        </div>
        <p-divider type="dashed" styleClass="mt-0 mt-md-4 mt-lg-45 mb-4 mb-lg-45"></p-divider>
        <div class="sewn-form-field information-wrapper mb-md-4 mb-lg-45">
            <div>
                <label>{{ 'imformation_about_product' | translate }}<span class="star">*</span></label>
                <label class="float-right limitFont"
                    >{{ productForm.get('information').value | wordCount }}/300 {{ 'words' | translate }}</label
                >
            </div>
            <textarea
                type="text"
                [placeholder]="'describe_product_features' | translate"
                formControlName="information"
                [rows]="5"
                pInputText
            ></textarea>
            <small *ngIf="productForm.controls['information'].errors?.required" class="p-error">
                {{ 'required' | translate }}
            </small>
            <small *ngIf="productForm.controls['information'].errors?.maxWordCount" class="p-error">
                Please input 300 words
            </small>
        </div>
        <div class="col-4 d-none d-lg-block"></div>
        <div class="d-flex flex-wrap">
            <div class="col-12 mb-3 p-0">
                <span class="primary_txt fnt-16">{{ 'vat_details' | translate }}</span
                ><br />
            </div>
            <div class="sewn-form-field mr-md-3 mr-lg-4 vat-type-wrapper">
                <label class="mb-2">{{ 'select_vat_type' | translate }}<span class="star">*</span></label>
                <p-dropdown
                    [options]="vatSettings"
                    optionLabel="label"
                    [placeholder]="'select_subscription_type' | translate"
                    styleClass="w-100"
                    formControlName="vat_setting_id"
                    optionValue="value"
                ></p-dropdown>
                <small *ngIf="productForm.controls['vat_setting_id'].errors?.required" class="p-error">
                    {{ 'required' | translate }}
                </small>
            </div>
            <div class="sewn-form-field ml-md-3 ml-lg-4 mt-2 mt-md-0 col-12 col-md-6 p-0">
                <label class="fnt-14 fnt-600 fnt-muli txt-clr-554">
                    {{ 'is_product_price_vat' | translate }}<span class="star">*</span>
                </label>
                <p-checkbox
                    formControlName="is_price_including_vat"
                    binary="true"
                    [label]="'price_inclusive_vat' | translate"
                >
                </p-checkbox>
            </div>
        </div>
        <div class="d-flex flex-column flex-md-row justify-content-md-between mt-2 mt-md-45">
            <button
                type="button"
                class="btn btn-raised order-1 order-md-2 w-mob-100"
                (click)="togglePublic(true)"
                *ngIf="!isPublished && productID"
            >
                {{ 'publish' | translate }}
            </button>
            <div class="d-flex flex-column flex-md-row order-2 order-md-1">
                <button
                    type="button"
                    class="btn btn-stroked order-2 order-md-1 mt-3 mt-md-0 w-mob-100"
                    (click)="onCancel()"
                >
                    {{ 'cancel' | translate }}
                </button>
                <button
                    type="submit"
                    class="btn btn-raised ml-md-3 order-1 order-md-2 mt-md-0 w-mob-100"
                    [ngClass]="{ 'mt-3': productID }"
                    (click)="uploadImages()"
                >
                    {{ 'save' | translate }}
                </button>
            </div>
        </div>
    </div>
</div>
