<div class="d-flex justify-content-between mb-3">
    <span class="primary_txt fnt-16">{{ 'product_weights' | translate }}</span>
    <div class="d-none d-md-block d-lg-none addWeightDiv" (click)="addNewWeights()">
        <img class="mb-z5" src="assets/images/add_grey.svg" />
        <span class="ml-2 fnt-muli fnt-700 fnt-14 text-clr334"> {{ 'add_weight_variant' | translate }} </span>
    </div>
</div>

<div [formGroup]="weightForm" class="d-flex flex-wrap flex-lg-nowrap" *ngIf="weightForm.get('weights')">
    <div class="d-none d-lg-block productWeightDiv">
        <div *ngFor="let weight of this.weightForm['value']['weights']; let i = index" class="mb-3">
            <a
                class="
                    d-flex
                    justify-content-between
                    align-items-center
                    p-3
                    br-4
                    border-main
                    cursor-pointer
                    weight-item
                "
                [ngClass]="{ active: currentVariantIndex == i }"
                [class.invalid]="isInvalidWeightVariant(i)"
                (click)="currentVariantIndex = i"
            >
                <div class="fnt-muli fnt-14 fnt-600 lh-normal text-clr334">
                    {{ 'weight' | translate }} - {{ weight.weight }} {{ weight.weight_unit }}
                </div>
                <img src="assets/images/right-arrow.svg" alt="" />
            </a>
        </div>
        <div class="addWeightDiv" (click)="addNewWeights()">
            <img class="mb-z5" src="assets/images/add_grey.svg" />
            <span class="ml-2 fnt-muli fnt-700 fnt-14 text-highlited">
                {{ 'add_weight_variant' | translate }}
            </span>
        </div>
    </div>
    <div class="col-12 d-block d-md-none mb-3 weight-variant-array p-0">
        <p-dropdown
            [options]="weightVariantArray"
            optionLabel="label"
            placeholder=""
            styleClass="w-100 p-dropdown-variantType"
            [(ngModel)]="currentVariantIndex"
            optionValue="value"
            [ngModelOptions]="{ standalone: true }"
        >
            <ng-template let-weight pTemplate="item">
                <span *ngIf="weight.label">{{ weight.label }}</span>
                <span *ngIf="!weight.label" class="weightVariantBtn w-100" (click)="addNewWeights()">
                    <img class="" src="assets/images/add_green_icon.svg" />
                    <span class="ml-2 fnt-muli fnt-700 fnt-14 text-highlited cursor-pointer">
                        {{ 'add_weight_variant' | translate }}
                    </span>
                </span>
            </ng-template>
        </p-dropdown>
    </div>
    <span
        class="fnt-700 editBtn align-items-center d-flex d-md-none mb-3"
        *ngIf="weights?.length > 1"
        (click)="deleteWeightVariant(currentVariantIndex)"
    >
        {{ 'delete_weight_variant' | translate }}
    </span>
    <div class="pl-lg-4 weight-form-wrapper">
        <p-tabView [(activeIndex)]="currentVariantIndex" styleClass="weight-tabview">
            <p-tabPanel
                *ngFor="let currentForm of weightForm.controls['weights']['controls']; let i = index"
                formArrayName="weights"
            >
                <ng-template pTemplate="header">
                    <span>
                        {{ 'weight' | translate }} - {{ currentForm.value.weight }}
                        {{ currentForm.value.weight_unit }}
                        <span (click)="$event.stopPropagation(); deleteWeightVariant(i)" *ngIf="weights?.length > 1">
                            <img src="assets/images/delete-variant-name.svg" alt="delete" />
                        </span>
                    </span>
                </ng-template>
                <div [formGroupName]="i" class="">
                    <div class="row gutter-16 mt-2 mt-md-3 mt-lg-0 position-relative">
                        <div class="col-12 mb-4 d-flex d-md-none">
                            <div class="col-6 pl-0">
                                <p-checkbox
                                    formControlName="is_default_product"
                                    binary="true"
                                    [label]="'set_default_product' | translate"
                                    (onChange)="handleSetDefault.emit($event)"
                                    *ngIf="currentForm?.value.is_default_product || !isSetDefault"
                                >
                                </p-checkbox>
                            </div>
                            <div class="col-6 pl-0">
                                <p-checkbox
                                    formControlName="is_hide"
                                    binary="true"
                                    [label]="'hide_product' | translate"
                                    (onChange)="handleHideProduct()"
                                >
                                </p-checkbox>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-3 sewn-form-field">
                            <label>{{ 'weight' | translate }}<span class="star">*</span></label>
                            <div class="input-and-select gray">
                                <p-inputNumber formControlName="weight"></p-inputNumber>
                                <p-dropdown
                                    formControlName="weight_unit"
                                    [options]="weightTypeArray"
                                    autoDisplayFirst="false"
                                    (onChange)="onWeightUnitChange()"
                                ></p-dropdown>
                                <small *ngIf="currentForm?.controls['weight'].errors?.required" class="p-error">
                                    {{ 'required' | translate }}
                                </small>
                                <small *ngIf="currentForm?.controls['weight'].errors?.min" class="p-error">
                                    {{ 'minimum_quantity_is_100g' | translate }}
                                </small>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 col-lg-3 sewn-form-field">
                            <label>{{ 'status' | translate }}<span class="star">*</span></label>
                            <p-dropdown
                                formControlName="status"
                                [options]="statusArray"
                                autoDisplayFirst="false"
                            ></p-dropdown>
                            <small *ngIf="currentForm?.controls['status'].errors?.required" class="p-error">
                                {{ 'required' | translate }}
                            </small>
                        </div>
                        <p-divider type="dashed" class="col-12 d-md-none" styleClass="mt-2 mb-4"></p-divider>
                        <div
                            class="
                                col-12 col-md-4 col-lg-6
                                d-none d-md-flex
                                mb-4
                                justify-content-end justify-content-lg-start
                                align-items-lg-end
                                flex-column flex-lg-row
                                pl-3
                            "
                        >
                            <p-checkbox
                                formControlName="is_hide"
                                binary="true"
                                class="mr-4 mb-3 mb-lg-0"
                                label="Hide product"
                                (onChange)="handleHideProduct()"
                            >
                            </p-checkbox>
                            <p-checkbox
                                formControlName="is_default_product"
                                binary="true "
                                label="Set as default product"
                                (onChange)="handleSetDefault.emit($event)"
                                *ngIf="currentForm?.value.is_default_product || !isSetDefault"
                            >
                            </p-checkbox>
                        </div>
                        <span
                            class="fnt-700 delete-weight-variant cursor-pointer align-items-center d-none d-lg-flex"
                            *ngIf="weights?.length > 1"
                            (click)="deleteWeightVariant(currentVariantIndex)"
                        >
                            <img src="assets/images/delete-variant.svg" alt="delete" />
                            {{ 'delete_weight_variant' | translate }}
                        </span>
                    </div>
                    <div
                        formArrayName="grind_variants"
                        *ngFor="
                            let grind_variant of currentForm?.get('grind_variants')?.controls;
                            let i = index;
                            last as isLast
                        "
                    >
                        <div class="d-flex">
                            <div [formGroupName]="i" class="row gutter-16 flex-1">
                                <div class="col-12 col-md-4 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                                    <label>{{ 'price' | translate }}<span class="star">*</span></label>
                                    <div class="p-input-icon-left">
                                        <input type="number" formControlName="price" pInputText />
                                        <span class="left-icon fnt-muli fnt-14 fnt-normal text-clr334 lh-normal"
                                            >SEK</span
                                        >
                                        <small
                                            *ngIf="grind_variant['controls']['price'].errors?.required"
                                            class="p-error"
                                        >
                                            {{ 'required' | translate }}
                                        </small>
                                        <small *ngIf="grind_variant['controls']['price'].errors?.min" class="p-error">
                                            {{ 'must_be_greater_than' | translate }} 0
                                        </small>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-3 sewn-form-field mr-md-4 mr-lg-0 mb-3 mb-lg-4">
                                    <label>{{ 'grind' | translate }}<span class="star">*</span></label>
                                    <p-dropdown
                                        [options]="grindArray"
                                        placeholder="Please select the grind variant"
                                        formControlName="grind"
                                    ></p-dropdown>
                                    <small *ngIf="grind_variant['controls']['grind'].errors?.required" class="p-error">
                                        {{ 'required' | translate }}
                                    </small>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                                    <label>{{ 'stock_available' | translate }}<span class="star">*</span></label>
                                    <div class="p-input-icon-right">
                                        <input type="number" pInputText formControlName="available_quantity" />
                                        <span class="right-icon fnt-muli fnt-14 fnt-normal text-clr334 lh-normal">{{
                                            grind_variant.value.available_quantity_type
                                        }}</span>
                                        <small
                                            *ngIf="grind_variant['controls']['available_quantity'].errors?.required"
                                            class="position-absolute p-error"
                                        >
                                            {{ 'required' | translate }}
                                        </small>
                                        <small
                                            *ngIf="grind_variant['controls']['available_quantity'].errors?.min"
                                            class="position-absolute p-error"
                                        >
                                            {{ 'must_be_greater_than' | translate }} 0
                                        </small>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-3 sewn-form-field mb-3 mb-lg-4">
                                    <label>{{ 'sku_number' | translate }}<span class="star">*</span></label>
                                    <input type="text" formControlName="sku_number" pInputText />
                                    <small
                                        *ngIf="grind_variant['controls']['sku_number'].errors?.required"
                                        class="p-error"
                                    >
                                        {{ 'required' | translate }}
                                    </small>
                                </div>
                                <div
                                    class="
                                        col-12 col-md-1
                                        sewn-form-field
                                        pl-md-0 pl-lg-2
                                        justify-content-end
                                        d-lg-none
                                        mb-3
                                    "
                                    *ngIf="i != 0 || !isLast"
                                >
                                    <span
                                        class="fnt-700 editBtn mb-2"
                                        *ngIf="i != 0 || !isLast"
                                        (click)="deleteGrindVariant(i)"
                                    >
                                        {{ 'delete' | translate }}
                                    </span>
                                </div>
                                <p-divider
                                    type="dashed"
                                    class="col-12"
                                    styleClass="mt-2 mb-3 mb-md-4 d-lg-none"
                                ></p-divider>
                            </div>
                            <div
                                class="sewn-form-field pl-3 justify-content-end d-none d-lg-inline-flex"
                                *ngIf="i != 0 || !isLast"
                            >
                                <span
                                    class="fnt-700 editBtn mb-2"
                                    *ngIf="i != 0 || !isLast"
                                    (click)="deleteGrindVariant(i)"
                                >
                                    {{ 'delete' | translate }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <img src="assets/images/add-partner.svg" />
                        <span
                            class="ml-2 fnt-muli fnt-700 fnt-14 editBtn"
                            (click)="addNewGrindVariants(currentForm.value.is_hide)"
                        >
                            {{ 'add_grind_variant' | translate }}
                        </span>
                    </div>
                    <p-divider type="dashed" class="col-12 p-0" styleClass="mt-3 mb-0 d-md-none"></p-divider>
                    <div class="w-100 mt-4 mt-lg-45">
                        <div class="fnt-16 fnt-muli fnt-700 text-clr334 mb-3">
                            {{ 'add_images' | translate }}
                        </div>
                        <div class="row gutter-16 flex-nowrap overflow-auto pb-2 pb-md-25 pb-lg-3">
                            <div class="col sewn-form-field mb-0">
                                <label class="text-nowrap"
                                    >{{ ((isMobile$ | async) ? 'feature_image' : 'upload_feature_image') | translate
                                    }}<span class="star">*</span></label
                                >
                                <app-product-image
                                    formControlName="featured_image_id"
                                    accept="image/png, image/jpeg"
                                ></app-product-image>
                                <small
                                    *ngIf="currentForm.controls.featured_image_id.errors?.required"
                                    class="p-error"
                                    >{{ 'required' | translate }}</small
                                >
                            </div>
                            <div
                                class="col sewn-form-field mb-0"
                                *ngFor="let productImage of currentForm?.get('product_images').controls"
                            >
                                <label>{{ 'product_images' | translate }}</label>
                                <app-product-image
                                    [formControl]="productImage"
                                    accept="image/png, image/jpeg"
                                ></app-product-image>
                            </div>
                        </div>
                    </div>
                </div>
            </p-tabPanel>
        </p-tabView>
    </div>
</div>
