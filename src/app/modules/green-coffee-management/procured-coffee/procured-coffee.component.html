<div class="main-block">
    <ng-container *ngIf="isLoaded; else loading">
        <div class="row">
            <div class="col-lg-12">
                <div class="sourcing-details">
                    <div class="overflow-auto flex-nowrap breadCrumb">
                        <p-breadcrumb [model]="breadItems"></p-breadcrumb>
                    </div>
                    <div class="w-100 mt-4 pt-lg-2 clearfix botSpacing avaialble-web">
                        <div class="source-det-tit pull-left pt-2">
                            <div class="det-tit d-inline-block">
                                <h2>Order #{{ orderDetails?.id }}</h2>
                            </div>
                        </div>
                        <div class="text-white pull-right">
                            <button
                                class="btn-raised"
                                routerLink="/green-coffee-management/coffee-sale"
                                [queryParams]="{ orderId: orderDetails?.id }"
                                [disabled]="orderDetails?.ro_gc_id"
                            >
                                Mark for sale
                            </button>
                        </div>
                    </div>
                    <div class="row avaialble-mob p-0">
                        <h2 class="fnt-16 fnt-md-18 fw-b text-clr334 pl-3 mt-4 mb-3">Order #{{ orderDetails?.id }}</h2>
                        <div class="col-sm-12">
                            <button
                                class="btn-raised w-100"
                                routerLink="/green-coffee-management/coffee-sale"
                                [queryParams]="{ orderId: orderDetails?.id }"
                            >
                                Mark for sale
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="prodect-details mt-4">
            <div class="row">
                <div class="col-lg-6 col-md-12 col-sm-12 mb-3 no-pad">
                    <div class="prodect-gal">
                        <gallery id="basic-test" [items]="items" gallerize></gallery>
                    </div>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                    <div class="product-description">
                        <div class="row ml-md-0 mr-md-0">
                            <div class="col-lg-12 border-class">
                                <div class="estate-focus">
                                    <ul class="clearfix">
                                        <li>
                                            <label>Quantity availabile</label>
                                            <p>
                                                {{ orderDetails?.quantity_count * orderDetails?.quantity | number }} kg
                                            </p>
                                        </li>
                                        <li>
                                            <label>Remaining quantity availabile</label>
                                            <p>{{ orderDetails?.remaining_total_quantity }} kg</p>
                                        </li>
                                        <li>
                                            <label>Buying price</label>
                                            <p>
                                                {{ orderDetails?.buying_price }}
                                                {{ orderDetails?.buying_price_unit }}/kg
                                            </p>
                                        </li>
                                        <li>
                                            <label>Roaster reference no</label>
                                            <p>{{ orderDetails?.order_reference }}</p>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4 ml-md-0 mr-md-0">
                            <h3
                                class="d-none d-sm-none d-xl-none d-lg-none d-md-block pb-1 fnt-16 fnt-md-18 fw-b text-clr334"
                            >
                                Green coffee details
                            </h3>
                            <div *ngIf="orderDetails" class="col-12 border-class">
                                <p-tabView styleClass=" mt-1 pb-md-2" [(activeIndex)]="selectedTab">
                                    <p-tabPanel header="{{ 'green_coffee_details' | translate }}">
                                        <div class="col-lg-12 px-1 px-md-0 mt-4 mt-md-3">
                                            <div class="estate-focus">
                                                <ul class="clearfix">
                                                    <li>
                                                        <label>Estate</label>
                                                        <p>
                                                            {{ orderDetails?.estate_name || 'NA' }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Origin</label>
                                                        <p>
                                                            {{ orderDetails?.origin | country }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Lot ID</label>
                                                        <p>
                                                            {{ orderDetails?.lot_number || 'NA' }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Availability name</label>
                                                        <p>
                                                            {{ orderDetails?.availability_name || 'NA' }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Species</label>
                                                        <p>
                                                            {{ orderDetails?.species || 'NA' }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Variety</label>
                                                        <p *ngIf="orderDetails.varieties">
                                                            {{ orderDetails?.varieties | translate }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Crop year</label>
                                                        <p>
                                                            {{ orderDetails?.harvest_date | date: 'MMM, y' }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Altitude</label>
                                                        <p>
                                                            {{ orderDetails?.altitude || 'NA' }}
                                                            meters above sea level
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>{{ 'flavor_profile' | translate }}</label>
                                                        <p>
                                                            {{ orderDetails?.flavour_profile || 'NA' }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>{{ 'wet_mill' | translate }}</label>
                                                        <p>
                                                            {{ orderDetails?.wet_mill || 'NA' }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Processing</label>
                                                        <p>
                                                            {{ orderDetails?.processing || 'NA' }}
                                                        </p>
                                                    </li>
                                                    <li>
                                                        <label>Moisture content</label>
                                                        <p>
                                                            {{ orderDetails?.dry_milling?.moisture_content || 'NA' }}
                                                        </p>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="ml-0 ml-md-2 mt-3 pl-1">
                                                <a
                                                    class="brown-cta mt-"
                                                    routerLink="/sourcing/coffee-details/{{ orderDetails.harvest_id }}"
                                                    >View more details
                                                </a>
                                            </div>
                                        </div>
                                    </p-tabPanel>
                                    <p-tabPanel header="{{ 'roaster_notes' | translate }}">
                                        <div class="col-lg-12 px-1 px-md-0 mt-4 mt-md-3">
                                            <div class="estate-focus">
                                                <ul class="clearfix">
                                                    <li *ngFor="let notes of roasterNotes">
                                                        <div class="real-estate d-flex">
                                                            <div class="p-photo">
                                                                <img class="img-procured" [src]="notes?.dp_thumb" />
                                                            </div>
                                                            <div class="px-2">
                                                                <p class="fnt-14 fw-m text-clr334 mb-3 w-100">
                                                                    {{ notes?.first_name }}&nbsp;{{
                                                                        notes?.last_name
                                                                    }}&nbsp;&#8226;&nbsp;
                                                                    <span class="dateAt">{{
                                                                        notes?.created_at | date: 'd MMMM y'
                                                                    }}</span>
                                                                </p>
                                                                <p class="fnt-14 fnt-normal text-clr588 w-100 notes">
                                                                    {{ notes?.comment }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </p-tabPanel>
                                </p-tabView>
                            </div>
                        </div>
                        <div class="row mt-4 ml-md-0 mr-md-0">
                            <div class="col-lg-12 border-class">
                                <div class="produect-pro">
                                    <div *ngIf="orderDetails" class="row">
                                        <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                            <div class="real-estate">
                                                <h6 class="mt-0" *ngIf="orderDetails['cupping_at']">
                                                    {{ orderDetails['cupping_at'] | date: 'dd MMM, yyyy' }}
                                                </h6>
                                                <p class="text-clr334 fw-m fnt-14 mb-0">
                                                    <span class="text-clr588 fw-m fnt-14 pr-md-3 mr-md-1 text-head"
                                                        >{{ 'cup_score' | translate }} :</span
                                                    >
                                                    {{ orderDetails?.cup_score || 'NA' }}
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-xl-5 col-lg-5 col-md-5 col-sm-6">
                                            <div class="real-estate d-grid p-date">
                                                <div class="p-photo">
                                                    <app-user-detail
                                                        [imageUrl]="orderDetails?.evaluator_dp_thumb"
                                                        [userId]="orderDetails?.evaluator_id"
                                                        orgType="fc"
                                                        [size]="(isMobile$ | async) ? 32 : 38"
                                                    ></app-user-detail>
                                                </div>

                                                <h3>
                                                    {{ orderDetails?.evaluator_name || 'NA' }}
                                                </h3>
                                                <h6 class="mt-0">Facilitator</h6>
                                            </div>
                                        </div>

                                        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 v-report">
                                            <a class="brown-cta" (click)="viewReport()">View report </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4 ml-md-0 mr-md-0">
                            <div class="fnt-14 fw-b mb-2">{{ 'order_activity' | translate }}</div>
                            <p-table
                                id="tabTable"
                                #markedTable
                                [class.table-mobile]="primeTableService.isMobileView"
                                [value]="activityValue"
                                [columns]="primeTableService._allColumns"
                                dataKey="id"
                                styleClass="ui-table-customers"
                                [showCurrentPageReport]="false"
                                [responsive]="primeTableService.isMobileView"
                            >
                                <ng-template pTemplate="colgroup" let-columns>
                                    <colgroup>
                                        <col
                                            *ngFor="let col of columns"
                                            [style.width]="col.width ? col.width + 'px' : '50px'"
                                        />
                                    </colgroup>
                                </ng-template>

                                <ng-template pTemplate="header" let-columns>
                                    <tr>
                                        <th
                                            *ngFor="let col of columns"
                                            [pSortableColumn]="col.sortable ? col.field : null"
                                        >
                                            <span class="primeng-table-header">{{ col.header }}</span>
                                            <p-sortIcon *ngIf="col.sortable" [field]="col.field"> </p-sortIcon>
                                        </th>
                                    </tr>
                                </ng-template>

                                <ng-template pTemplate="body" let-rowData let-columns="columns">
                                    <tr>
                                        <td *ngFor="let col of columns" [ngSwitch]="col.field">
                                            <span *ngSwitchCase="'created_at'">
                                                <div class="d-flex">
                                                    <span
                                                        *ngIf="primeTableService.isMobileView"
                                                        class="prime-table-label text-clr588 w-50"
                                                    >
                                                        {{ 'date' | translate }}
                                                    </span>
                                                    <span [class.w-50]="primeTableService.isMobileView">
                                                        {{ rowData['created_at'] | date: 'd MMM yyyy' }}
                                                    </span>
                                                </div>
                                            </span>
                                            <span *ngSwitchCase="'location'">
                                                <div class="d-flex">
                                                    <span
                                                        *ngIf="primeTableService.isMobileView"
                                                        class="prime-table-label text-clr588 w-50"
                                                    >
                                                        {{ 'location' | translate }}
                                                    </span>
                                                    <span
                                                        [class.w-50]="primeTableService.isMobileView"
                                                        class="truncate break-word"
                                                    >
                                                        <span *ngIf="rowData.catalogue === 'RO_GREEN_COFFEE'">{{
                                                            'green_inventory' | translate
                                                        }}</span>
                                                        <span *ngIf="rowData.catalogue === 'RO_GREEN_COFFEE_SAMPLE'">{{
                                                            'sample quantity' | translate
                                                        }}</span>
                                                        <span *ngIf="rowData.catalogue === 'OUTTAKE_ORDER'">{{
                                                            'outtake_order' | translate
                                                        }}</span>
                                                        <span *ngIf="rowData.catalogue === 'RO_BATCH'">{{
                                                            'roasted_coffee_batch' | translate
                                                        }}</span>
                                                        <span *ngIf="rowData.catalogue === 'RO_CUPPING'">{{
                                                            'sample_cupping' | translate
                                                        }}</span>
                                                    </span>
                                                </div>
                                            </span>
                                            <span *ngSwitchCase="'quantity'">
                                                <div class="d-flex">
                                                    <span
                                                        *ngIf="primeTableService.isMobileView"
                                                        class="prime-table-label text-clr588 w-50"
                                                    >
                                                        {{ 'quantity' | translate }}
                                                    </span>

                                                    <span [class.w-50]="primeTableService.isMobileView">
                                                        {{ rowData['total_quantity'] }}&nbsp; kg
                                                    </span>
                                                </div>
                                            </span>
                                            <span *ngSwitchCase="'actions'" class="text-center">
                                                <ng-container *ngIf="!primeTableService.isMobileView">
                                                    <span
                                                        *ngIf="!rowData.is_deleted"
                                                        class="brown-cta"
                                                        (click)="availabilityPage(rowData)"
                                                        >{{ 'view' | translate }}</span
                                                    >
                                                </ng-container>
                                            </span>
                                            <span *ngSwitchDefault>
                                                {{ rowData[col.field] }}
                                            </span>
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="summary">
                                    <app-empty
                                        *ngIf="!activityValue?.length || activityValue?.length < 1"
                                        [title]="'no_data_available' | translate"
                                    ></app-empty>
                                </ng-template>
                            </p-table>
                            <div class="w-100 mt-4">
                                <p-paginator
                                    [rows]="5"
                                    [totalRecords]="totalRecords"
                                    (onPageChange)="paginate($event)"
                                ></p-paginator>
                            </div>
                        </div>
                    </div>
                </div>
            </div></div
    ></ng-container>
</div>

<ng-template #loading>
    <app-loading></app-loading>
</ng-template>
