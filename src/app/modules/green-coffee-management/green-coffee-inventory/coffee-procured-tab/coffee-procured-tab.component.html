<div class="mt-4">
    <p-dropdown
        [options]="originArray"
        [showClear]="true"
        optionLabel="name"
        optionValue="isoCode"
        [(ngModel)]="termStatus"
        (onChange)="setStatus()"
        scrollHeight="225px"
        placeholder="{{ globals.languageJson?.all_origins }}"
        [autoDisplayFirst]="false"
        styleClass="round-border mr-2 mb-3 {{ termStatus ? 'highlight' : '' }}"
    ></p-dropdown>
    <div class="float-right mobile-lead">
        <p-dropdown
            [options]="displayItems"
            [showClear]="true"
            [(ngModel)]="display"
            (onChange)="setDisplay()"
            scrollHeight="225px"
            placeholder="Display"
            [autoDisplayFirst]="false"
            styleClass="round-border mb-3 {{ display ? 'highlight' : '' }}"
        ></p-dropdown>
    </div>
</div>

<!-- Primeng table for Procured Coffee -->
<div class="coffee-procured">
    <p-table
        #procuredCoffeeTable
        [class.table-mobile]="primeTableService.isMobileView"
        [value]="primeTableService.records"
        [columns]="primeTableService._allColumns"
        [(selection)]="primeTableService.selectedRecords"
        dataKey="id"
        styleClass="ui-table-customers"
        [rows]="primeTableService.rows"
        [showCurrentPageReport]="false"
        [loading]="primeTableService.loading"
        [paginator]="primeTableService.paginationValue"
        [lazy]="true"
        (onLazyLoad)="primeTableService.getData($event)"
        [totalRecords]="primeTableService.totalRecords"
        [responsive]="primeTableService.isMobileView"
    >
        <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
                <col *ngFor="let col of columns" [style.width]="col.width ? col.width + 'px' : '50px'" />
            </colgroup>
        </ng-template>

        <ng-template pTemplate="header" let-columns>
            <tr>
                <th *ngFor="let col of columns" [pSortableColumn]="col.sortable === true ? col.field : null">
                    <span class="primeng-table-header">{{ col.header | translate }}</span>
                    <p-sortIcon
                        *ngIf="col.sortable === true"
                        [field]="col.field"
                        ariaLabel="Activate to sort"
                        ariaLabelDesc="Activate to sort in descending order"
                        ariaLabelAsc="Activate to sort in ascending order"
                    >
                    </p-sortIcon>
                </th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rowData let-columns="columns">
            <tr>
                <td
                    *ngFor="let col of columns"
                    [ngSwitch]="col.field"
                    [ngClass]="{ borderNone: col.field === 'order_reference' }"
                >
                    <span *ngSwitchCase="'availability_name'" [routerLink]="availabilityPage(rowData)">
                        <div class="d-flex">
                            <span *ngIf="primeTableService.isMobileView" class="prime-table-label text-clr588 w-50">
                                {{ 'availability_name' | translate }}
                            </span>

                            <span [class.w-50]="primeTableService.isMobileView">
                                {{ rowData['availability_name'] }}
                            </span>
                        </div>
                    </span>
                    <span *ngSwitchCase="'estate_name'" [routerLink]="availabilityPage(rowData)">
                        <div class="d-flex">
                            <span *ngIf="primeTableService.isMobileView" class="prime-table-label text-clr588 w-50">
                                {{ 'estate_name' | translate }}
                            </span>

                            <span [class.w-50]="primeTableService.isMobileView">
                                {{ rowData['estate_name'] }}
                            </span>
                        </div>
                    </span>
                    <span *ngSwitchCase="'status'" [routerLink]="availabilityPage(rowData)">
                        <span *ngIf="!primeTableService.isMobileView">
                            {{ rowData['status'] | titlecase }}
                        </span>
                    </span>
                    <span *ngSwitchCase="'varieties'" [routerLink]="availabilityPage(rowData)">
                        <div class="d-flex">
                            <span *ngIf="!primeTableService.isMobileView" class="truncate break-word">
                                {{ rowData['varieties'] || '--' }}
                            </span>
                        </div>
                    </span>
                    <span *ngSwitchCase="'origin'" [routerLink]="availabilityPage(rowData)">
                        <div class="d-flex">
                            <span *ngIf="!primeTableService.isMobileView" class="truncate break-word">
                                {{ rowData['origin'] | country | translate }}
                            </span>
                        </div>
                    </span>
                    <span *ngSwitchCase="'quantity'" [routerLink]="availabilityPage(rowData)">
                        <div class="d-flex">
                            <span *ngIf="primeTableService.isMobileView" class="prime-table-label text-clr588 w-50">
                                {{ 'quantity' | translate }}
                            </span>

                            <span *ngIf="primeTableService.isMobileView" class="w-50">
                                {{ rowData['quantity'] * rowData['quantity_count'] }}&nbsp; kg
                            </span>
                            <span *ngIf="!primeTableService.isMobileView" class="">
                                {{ rowData['quantity'] * rowData['quantity_count'] }}&nbsp; kg
                            </span>
                        </div>
                    </span>
                    <span *ngSwitchCase="'remaining_total_quantity'" [routerLink]="availabilityPage(rowData)">
                        <div class="d-flex">
                            <span *ngIf="primeTableService.isMobileView" class="prime-table-label text-clr588 w-50">
                                {{ 'remaining_quantity' | translate }}
                            </span>

                            <span *ngIf="primeTableService.isMobileView" class="w-50">
                                {{ rowData['remaining_total_quantity'] }}&nbsp; kg
                            </span>
                            <span *ngIf="!primeTableService.isMobileView" class="">
                                {{ rowData['remaining_total_quantity'] }}&nbsp; kg
                            </span>
                        </div>
                    </span>
                    <span *ngSwitchCase="'order_reference'">
                        <div class="d-flex">
                            <span [routerLink]="availabilityPage(rowData)">
                                <p
                                    *ngIf="primeTableService.isMobileView"
                                    class="fnt-16 fnt-md-18 txt-clr334 fnt-bold mb-0"
                                >
                                    {{ 'roaster_ref_no' | translate }}: {{ rowData['order_reference'] || '--' }}
                                </p>
                            </span>
                            <span [routerLink]="availabilityPage(rowData)">
                                <p *ngIf="!primeTableService.isMobileView" class="mb-0">
                                    {{ rowData['order_reference'] || '--' }}
                                </p>
                            </span>
                            <span class="ml-auto">
                                <ng-container *ngIf="primeTableService.isMobileView">
                                    <a
                                        class="menu-arrow"
                                        [popover]="poplistTemplate"
                                        placement="left"
                                        [outsideClick]="true"
                                        #pop="bs-popover"
                                    >
                                        <p class="mb-0">
                                            <img class="ellipse-image" src="assets/images/ellipses.png" alt="" />
                                        </p>
                                    </a>
                                    <ng-template #poplistTemplate>
                                        <div id="popover-mobile-content">
                                            <ul class="list-group custom-popover">
                                                <li class="list-group-item">
                                                    <a
                                                        class="text-clr588 fnt-600 fnt-14"
                                                        [routerLink]="viewOrderPage(rowData)"
                                                        [queryParams]="{ type: rowData.status, order: rowData.id }"
                                                        >{{ 'view_order_page' | translate }}</a
                                                    >
                                                </li>
                                                <li class="list-group-item">
                                                    <a
                                                        class="text-clr588 fnt-600 fnt-14"
                                                        [routerLink]="sourcingRedirect(rowData)"
                                                    >
                                                        {{ 'go_to_availability_page' | translate }}</a
                                                    >
                                                </li>
                                            </ul>
                                        </div>
                                    </ng-template>
                                </ng-container>
                            </span>
                        </div>
                    </span>
                    <span *ngSwitchCase="'id'" [routerLink]="availabilityPage(rowData)">
                        <span *ngIf="!primeTableService.isMobileView">
                            {{ rowData[col.field] }}
                        </span>
                        <div class="d-flex">
                            <span *ngIf="primeTableService.isMobileView" class="mobile-heading w-50">
                                {{ 'order_id' | translate }} #{{ rowData[col.field] }}
                            </span>
                            <span
                                *ngIf="!primeTableService.isMobileView; else mobile_name"
                                [class.prime-table-heading]="primeTableService.isMobileView"
                                class="w-50"
                            >
                            </span>
                            <ng-template #mobile_name>
                                <span class="ml-auto">
                                    <ng-container *ngIf="primeTableService.isMobileView">
                                        <span class="pull-right brown-cta" [routerLink]="availabilityPage(rowData)"
                                            >{{ 'view' | translate }}
                                        </span>
                                    </ng-container>
                                </span>
                            </ng-template>
                        </div>
                    </span>
                    <span *ngSwitchCase="'actions'" class="text-center" [routerLink]="availabilityPage(rowData)">
                        <ng-container *ngIf="!primeTableService.isMobileView">
                            <span class="brown-cta" [routerLink]="availabilityPage(rowData)">View</span>
                        </ng-container>
                    </span>
                    <span *ngSwitchCase="'options'" class="text-center">
                        <ng-container *ngIf="!primeTableService.isMobileView">
                            <a
                                class="menu-arrow"
                                [popover]="poplistTemplate"
                                placement="left"
                                [outsideClick]="true"
                                #pop="bs-popover"
                            >
                                <p class="mb-0">
                                    <img class="ellipse-image" src="assets/images/ellipses.png" alt="" />
                                </p>
                            </a>
                            <ng-template #poplistTemplate>
                                <div id="popover-mobile-content">
                                    <ul class="list-group custom-popover">
                                        <li class="list-group-item">
                                            <a
                                                class="text-clr588 fnt-600 fnt-14"
                                                [routerLink]="viewOrderPage(rowData)"
                                                [queryParams]="{ type: rowData.status, order: rowData.id }"
                                                >{{ 'view_order_page' | translate }}</a
                                            >
                                        </li>
                                        <li class="list-group-item">
                                            <a
                                                class="text-clr588 fnt-600 fnt-14"
                                                [routerLink]="sourcingRedirect(rowData)"
                                            >
                                                {{ 'go_to_availability_page' | translate }}</a
                                            >
                                        </li>
                                    </ul>
                                </div>
                            </ng-template>
                        </ng-container>
                    </span>
                    <span *ngSwitchDefault>
                        {{ rowData[col.field] }}
                    </span>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
