<section *ngIf="isLoaded; else loading">
    <div class="bg-white br-4">
        <div class="p-3 px-md-5 pt-md-5 pb-md-3">
            <a class="back-page" routerLink="/sourcing/coffee-list"> {{ globals.languageJson?.back }}</a>
        </div>
        <div class="solid-divider d-md-none w-100"></div>

        <div class="p-3 px-md-5 d-md-none">
            <div class="w-100 d-flex">
                <div class="mr-2 pr-1">
                    <app-avatar
                        [size]="48"
                        [src]="sourcing.harvestDetail.estate_profile_image_thumbnail_url"
                        [name]="sourcing.harvestDetail?.estate_name"
                    ></app-avatar>
                </div>
                <div>
                    <h2 class="fnt-18 fnt-bold text-clr24 mb-0">{{ sourcing.harvestDetail?.estate_name }}</h2>
                    <div class="d-flex justify-content-start align-items-center">
                        <span class="fa fa-star checked mr-2"></span>
                        <h6 class="fnt-18 fnt-700 custom-link mb-0">
                            {{ (sourcing.harvestDetail?.estate_rating || 0).toFixed(2) }}
                        </h6>
                    </div>
                </div>
            </div>
        </div>
        <div class="p-3 px-md-5 d-none d-md-block">
            <div class="w-100 d-flex justify-content-between">
                <div class="d-flex">
                    <div class="d-inline-block mr-2 pr-1">
                        <app-avatar
                            [size]="54"
                            [src]="sourcing.harvestDetail.estate_profile_image_thumbnail_url"
                            [name]="sourcing.harvestDetail?.estate_name"
                        ></app-avatar>
                    </div>

                    <div class="d-inline-block">
                        <h2 class="fnt-18 fnt-bold text-clr24 mb-0">{{ sourcing.harvestDetail?.estate_name }}</h2>
                        <div class="d-flex justify-content-center justify-content-md-start align-items-center">
                            <span class="fa fa-star checked mr-2"></span>
                            <h6 class="fnt-18 fnt-700 custom-link mb-0">
                                {{ (sourcing.harvestDetail?.estate_rating || 0).toFixed(2) }}
                            </h6>
                        </div>
                    </div>
                </div>

                <div *ngTemplateOutlet="btnGroup" class="d-none d-mb-block"></div>
            </div>
        </div>

        <div class="px-2 px-md-5 pb-3 pb-md-4">
            <div class="br-md-main br-4 p-md-4">
                <div class="row">
                    <div class="col-12 col-lg-5 col-md-6">
                        <div class="prodect-gal p-2 p-md-0 mb-4 mb-md-5">
                            <gallery id="basic-test" class="bg-white" [items]="items" gallerize></gallery>
                        </div>
                        <div class="certify-green d-none d-md-block" *ngIf="sourcing.availableCertify != ''">
                            <h5 class="fnt-18 fnt-bold text-clr000">Certificates</h5>
                            <div class="pt-3 d-none d-md-block">
                                <img
                                    *ngFor="let cert of sourcing.availableCertify"
                                    [src]="cert.certificate_type_id | certificateImg"
                                    class="cert-img mb-3 ml-2"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-7 col-md-6">
                        <div class="br-sm-main br-4 p-3 p-md-0">
                            <div class="mb-2 mb-md-4">
                                <a
                                    class="custom-link"
                                    routerLink="/sourcing/lot-details/{{ sourcing.harvestDetail?.estateId }}/{{
                                        sourcing.harvestDetail?.lot_id
                                    }}"
                                >
                                    {{ globals.languageJson?.lot_id }} - {{ sourcing.harvestDetail?.lot_id }}
                                </a>
                            </div>
                            <div class="d-flex justify-content-between">
                                <h2 class="fnt-18 fnt-bold text-black334 mb-1">{{ sourcing.harvestDetail?.name }}</h2>
                                <div class="d-md-none d-flex">
                                    <img
                                        *ngFor="let cert of sourcing.availableCertify"
                                        [src]="cert.certificate_type_id | certificateImg"
                                        class="cert-img mb-3 ml-2"
                                    />
                                </div>
                            </div>

                            <h6 class="fnt-16 fnt-600 txt-clr334 mb-4">
                                <img src="assets/images/location-rating.png" alt="" />
                                {{ sourcing.harvestDetail?.country | country }}
                            </h6>
                            <p class="d-none d-md-block fnt-16 txt-clr334">
                                {{ sourcing.harvestDetail?.about }}
                            </p>
                            <p class="d-md-none mb-0 fnt-14 text-clr588">
                                {{ sourcing.harvestDetail?.about }}
                            </p>

                            <div class="row mt-md-5 mt-4">
                                <div class="col-lg-3 col-md-4 col-5 mb-md-3 mb-0">
                                    <div class="real-estate p-prices">
                                        <h6>{{ globals.languageJson?.price }} :</h6>
                                        <h3 class="mb-0">
                                            {{ sourcing.harvestDetail?.price_unit
                                            }}{{ sourcing.harvestDetail?.price }} USD / kg
                                        </h3>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 col-6 mb-md-3 mb-0 d-none d-md-block">
                                    <div class="real-estate">
                                        <h6>Inco :</h6>
                                        <h3 class="mb-0">{{ sourcing.harvestDetail?.incoterm }}</h3>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-7 mb-md-3 mb-0 br-left">
                                    <div class="real-estate">
                                        <h6>{{ globals.languageJson?.available_quantity }} :</h6>
                                        <h3 class="mb-0">
                                            {{ sourcing.harvestDetail?.quantity_count }}
                                            {{ sourcing.harvestDetail?.quantity_type }} of
                                            {{ sourcing.harvestDetail?.quantity
                                            }}{{ sourcing.harvestDetail?.quantity_unit }}
                                        </h3>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-4 col-6 mb-md-3 mb-0 d-none d-md-block br-left">
                                    <div class="real-estate">
                                        <h6>{{ globals.languageJson?.minimum_quantity }} :</h6>
                                        <h3 class="mb-0">
                                            {{ sourcing.harvestDetail?.initial_quantity
                                            }}{{ sourcing.harvestDetail?.quantity_type }}
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="produect-pro br-2 p-3 p-md-4 mt-4">
                                <div class="row">
                                    <div class="col-lg-4 col-md-4 col-sm-6">
                                        <div class="real-estate mt-0">
                                            <h6 class="mt-0">12 Feb, 2020</h6>
                                            <h3>
                                                {{ globals.languageJson?.cup_score }} :
                                                {{ sourcing.harvestDetail?.cupping?.cup_score }}
                                            </h3>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-6 mb-2 mb-md-0">
                                        <div class="real-estate d-flex mt-3 mt-md-0">
                                            <div class="mr-2 mr-md-3">
                                                <app-avatar
                                                    [size]="40"
                                                    [src]="sourcing.harvestDetail?.cupping.evaluator_dp_thumb"
                                                    [name]="sourcing.harvestDetail?.cupping.evaluator_name"
                                                ></app-avatar>
                                            </div>
                                            <div>
                                                <h3 class="mb-1">
                                                    {{ sourcing.harvestDetail?.cupping.evaluator_name }}
                                                </h3>
                                                <h6 class="my-0">Facilitator</h6>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-6 mt-2 text-left text-md-right">
                                        <a class="custom-link">{{ globals.languageJson?.view_report }} </a>
                                    </div>
                                </div>
                            </div>

                            <div class="d-md-none mt-3">
                                <ng-container *ngTemplateOutlet="btnGroup"></ng-container>
                            </div>
                        </div>

                        <div class="p-2 p-md-0">
                            <div class="row gutter-05 mt-md-5 mt-3 mb-md-5 mb-0">
                                <div class="col-lg-3 col-md-3 col-sm-6 col-6 mb-3">
                                    <div class="real-estate">
                                        <img src="assets/images/varient.svg" />
                                        <h6>{{ globals.languageJson?.species }}</h6>
                                        <h3>{{ sourcing.harvestDetail?.species }}</h3>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-6 col-6 mb-3">
                                    <div class="real-estate">
                                        <img src="assets/images/estate.svg" />
                                        <h6>{{ globals.languageJson?.variety }}</h6>
                                        <h3>{{ sourcing.harvestDetail?.varieties }}</h3>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-6 col-6 mb-md-3 mb-0">
                                    <div class="real-estate">
                                        <img src="assets/images/harveaster.svg" />
                                        <h6>Harvest Month</h6>
                                        <h3>{{ sourcing.harvestDetail?.harvest_date | date: 'MMMM ,y' }}</h3>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-md-5 mt-3 mb-md-5 mb-0">
                                <div class="col-lg-3 col-md-3 col-sm-6 col-6 mb-3 mr-md-5 mr-0">
                                    <div class="real-estate">
                                        <img src="assets/images/flavour-image.svg" />
                                        <h6>{{ globals.languageJson?.flavour_profile }}</h6>
                                        <h3 *ngIf="sourcing.harvestDetail?.flavours != null">
                                            {{ sourcing.harvestDetail?.flavours }}
                                        </h3>
                                        <h3 *ngIf="sourcing.harvestDetail?.flavours == null">NA</h3>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-6 col-6 mb-md-3 mb-0">
                                    <div class="real-estate">
                                        <img src="assets/images/altitute.svg" />
                                        <h6>Altitude range</h6>
                                        <h3>
                                            {{ sourcing.harvestDetail?.min_altitude }}-{{
                                                sourcing.harvestDetail?.max_altitude
                                            }}
                                            m
                                        </h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="estate-focus br-sm-main br-4 p-3 p-md-0">
                            <h3 class="fnt-18 fnt-bold text-clr000">{{ globals.languageJson?.estate_details }}</h3>
                            <ul class="clearfix">
                                <li>
                                    <label>Location :</label>
                                    <p>{{ sourcing.harvestDetail?.state }}</p>
                                </li>
                                <li>
                                    <label>Region :</label>
                                    <p>{{ sourcing.harvestDetail?.region }}</p>
                                </li>
                                <li>
                                    <label>Type :</label>
                                    <p>{{ sourcing.harvestDetail?.type }}</p>
                                </li>
                                <li>
                                    <label>Listing Status :</label>
                                    <p>{{ sourcing.harvestDetail?.listing_status }}</p>
                                </li>
                                <li>
                                    <label>Wet Mill processing :</label>
                                    <p>{{ sourcing.harvestDetail?.wet_milling?.process }}</p>
                                </li>
                                <li>
                                    <label>Fermentation/hr :</label>
                                    <p>{{ sourcing.harvestDetail?.wet_milling?.fermentation }}</p>
                                </li>
                                <li>
                                    <label>Dry milling process :</label>
                                    <p>{{ sourcing.harvestDetail?.dry_milling?.process }}</p>
                                </li>
                                <li>
                                    <label>Drying period :</label>
                                    <p>{{ sourcing.harvestDetail?.dry_milling?.drying_period }}</p>
                                </li>
                                <li>
                                    <label>Water activity :</label>
                                    <p>{{ sourcing.harvestDetail?.dry_milling?.water_activity }}</p>
                                </li>

                                <li>
                                    <label>Moisture :</label>
                                    <p>{{ sourcing.harvestDetail?.dry_milling?.moisture_content }}</p>
                                </li>
                                <li>
                                    <label>Packaging :</label>
                                    <p>{{ sourcing.harvestDetail?.packaging }}</p>
                                </li>
                            </ul>
                            <a class="custom-link mt-3" [href]="brandProfileEstateWeb" target="_blank">
                                Know more about the listing
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="sourcing.lot?.polygon_id">
                <app-remote-sensoring [polygonId]="sourcing.lot?.polygon_id"> </app-remote-sensoring>
            </div>
        </div>
    </div>

    <div class="bg-white br-4 pl-2 px-lg-5 py-3 py-lg-4 mt-4">
        <div class="px-0">
            <div class="fnt-18 fnt-bold text-clr000 mt-lg-2 mb-3 mb-lg-4">
                {{ globals.languageJson?.estates_other_green_coffee }}
            </div>
            <div *ngIf="sourcing.otherGreenList && sourcing.otherGreenList.length; else noOtherCoffee" class="row">
                <div
                    class="col-lg-4 col-md-6 col-12 cursor-pointer d-none d-md-block"
                    *ngFor="let item of sourcing.otherGreenList"
                    routerLink="/sourcing/coffee-details/{{ item.estate.id }}/{{ item.harvest_id }}"
                >
                    <app-harvest-card [data]="item"></app-harvest-card>
                </div>
                <!-- Mobile Carousel -->
                <div class="col-lg-4 col-md-6 col-12 cursor-pointer d-md-none">
                    <p-carousel
                        [value]="sourcing.otherGreenList"
                        [numVisible]="1"
                        [numScroll]="1"
                        [circular]="true"
                        [autoplayInterval]="3000"
                    >
                        <ng-template let-item pTemplate="item">
                            <div routerLink="/sourcing/coffee-details/{{ item.estate.id }}/{{ item.harvest_id }}">
                                <app-harvest-card [data]="item"></app-harvest-card>
                            </div>
                        </ng-template>
                    </p-carousel>
                </div>
            </div>
        </div>
    </div>
</section>

<ng-template #btnGroup>
    <div class="btn-wrap">
        <div class="pr-2">
            <button
                class="btn-stroked px-3"
                routerLink="/sourcing/order-gc-sample"
                [queryParams]="{ gc_id: sourcing.harvestId }"
            >
                Order sample
            </button>
        </div>
        <div class="pl-2">
            <button
                class="btn-raised"
                routerLink="/sourcing/buy-gc"
                [queryParams]="{ gc_id: sourcing.harvestId }"
                *ngIf="globals.checkItem('coffee-management') && globals.permissions['coffee-management'].manage"
            >
                Buy
            </button>
        </div>
    </div>
</ng-template>

<ng-template #loading>
    <div class="total-loader">
        <div>
            <img class="loader-gif web-loader" src="/assets/images/loader.gif" />
            <img class="loader-gif mob-loader" src="/assets/images/coffeeloader-mobile.gif" />
        </div>
    </div>
</ng-template>

<ng-template #noOtherCoffee>
    <app-blank title="No data available" button="Browse availabilities" link="/features/welcome-aboard"></app-blank>
</ng-template>
