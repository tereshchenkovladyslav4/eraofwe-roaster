<section>
    <div class="pt-1">
        <div class="col-12 pls-note">
            <p class="fnt-14 fnt-400 fnt-muli text-clr334 m-0">
                <span class="fnt-700">Please note : </span> Edit VAT rate only when you are sure of a change in the
                rates. A slight mistake can lead to a penalty from the authorities.
            </p>
        </div>
        <div *ngIf="!mobile">
            <div class="table-container mb-2 mt-43 col-12">
                <div class="table-responsive">
                    <table class="">
                        <thead class="table-header">
                            <tr class="header-row">
                                <th scope="col" class="fnt-bold">Country</th>
                                <th scope="col" class="fnt-bold">Transaction</th>
                                <th scope="col" class="fnt-bold">VAT Rate</th>
                                <th scope="col" class="fnt-bold">Action</th>
                            </tr>
                        </thead>
                        <tbody class="customtable">
                            <ng-container *ngIf="savemode">
                                <tr *ngFor="let add of addMr; let i = index">
                                    <td>
                                        <div class="">
                                            <select
                                                id="country"
                                                name="Year"
                                                class="form-control select-region"
                                                [(ngModel)]="add.country"
                                                name="country"
                                                required=""
                                                (change)="changeCountry()"
                                            >
                                                <option value="" selected="" disabled="">Select a Country</option>
                                                <option
                                                    *ngFor="let count of roasteryProfileService.countryList"
                                                    value="{{ count.isoCode }}"
                                                >
                                                    {{ count.name }}
                                                </option>
                                            </select>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="">
                                            <input
                                                class="form-control"
                                                type="text"
                                                placeholder="Please enter your type"
                                                name="transcation_type"
                                                [(ngModel)]="add.transaction_type"
                                            />
                                        </div>
                                    </td>
                                    <td>
                                        <div class="">
                                            <input
                                                class="form-control"
                                                type="number"
                                                placeholder="Enter percentage"
                                                name="vat_percentage"
                                                [(ngModel)]="add.vat_percentage"
                                            />
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex">
                                            <button
                                                type="button"
                                                class="fnt-14 fnt-muli fnt-700 add-vat"
                                                (click)="saveMrVat()"
                                                [disabled]="resetButtonValue === 'Saving'"
                                            >
                                                {{ resetButtonValue
                                                }}<img
                                                    class="loader"
                                                    *ngIf="resetButtonValue === 'Saving'"
                                                    src="assets/images/orange-loader.gif"
                                                />
                                            </button>
                                            <span class="view-order delete-cta cursor-pointer" (click)="deleteRow(i)">
                                                Delete
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                            </ng-container>
                            <ng-container>
                                <tr *ngFor="let item of mrList; let j = index">
                                    <td>
                                        <p *ngIf="editmode && eachId != item.id">{{ item.country | country }}</p>
                                        <p *ngIf="editmode && eachId == item.id && updateVatmode">
                                            {{ item.country | country }}
                                        </p>
                                        <div class="" *ngIf="editTableRow && eachId == item.id">
                                            <select
                                                id="country"
                                                name="Year"
                                                class="form-control select-region"
                                                [(ngModel)]="item.country"
                                                name="country"
                                                required=""
                                                (change)="changeCountry()"
                                            >
                                                <option value="" selected="" disabled="">Select a Country</option>
                                                <option
                                                    *ngFor="let count of roasteryProfileService.countryList"
                                                    value="{{ count.isoCode }}"
                                                >
                                                    {{ count.name }}
                                                </option>
                                            </select>
                                        </div>
                                    </td>
                                    <td>
                                        <p *ngIf="editmode && eachId != item.id">{{ item.transaction_type }}</p>
                                        <p *ngIf="editmode && eachId == item.id && updateVatmode">
                                            {{ item.transaction_type }}
                                        </p>
                                        <div class="" *ngIf="editTableRow && eachId == item.id">
                                            <input
                                                class="form-control"
                                                type="text"
                                                placeholder="Please enter your type"
                                                name="transcation_type"
                                                [(ngModel)]="item.transaction_type"
                                            />
                                        </div>
                                    </td>
                                    <td>
                                        <p *ngIf="editmode && eachId != item.id">{{ item.vat_percentage }}%</p>
                                        <p *ngIf="editmode && eachId == item.id && updateVatmode">
                                            {{ item.vat_percentage }}%
                                        </p>
                                        <div class="" *ngIf="editTableRow && eachId == item.id">
                                            <input
                                                class="form-control"
                                                type="number"
                                                placeholder="Enter percentage"
                                                name="vat_percentage"
                                                [(ngModel)]="item.vat_percentage"
                                            />
                                        </div>
                                    </td>
                                    <td>
                                        <div
                                            *ngIf="editmode && eachId != item.id"
                                            class="view-order"
                                            (click)="updateEachVat(item)"
                                        >
                                            Edit
                                        </div>
                                        <div
                                            *ngIf="editmode && eachId == item.id && updateVatmode"
                                            class="view-order"
                                            (click)="updateEachVat(item)"
                                        >
                                            Edit
                                        </div>
                                        <div class="d-flex" *ngIf="editTableRow && eachId == item.id">
                                            <button
                                                type="button"
                                                class="fnt-14 fnt-muli fnt-700 add-vat"
                                                (click)="saveEachMrVat(eachId, item)"
                                            >
                                                Save
                                            </button>
                                            <span
                                                class="view-order cursor-pointer delete-cta"
                                                (click)="deleteEachVat(eachId)"
                                                >Delete</span
                                            >
                                        </div>
                                    </td>
                                </tr>
                            </ng-container>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="add-partner d-inline-flex align-items-center mt-2">
                <span class="view-order cursor-pointer" (click)="addNewTranscation()">Add new transaction </span>
            </div>
        </div>
        <div *ngIf="mobile">
            <div class="row">
                <!--Mobile View-->
                <div class="col-12 p-2 d-md-none d-sm-none d-xs-block" *ngFor="let item of mrList; let i = index">
                    <div class="featureSectionCard" *ngIf="editIndex != i && item.id">
                        <label for="" class="header header-bg mb-0">
                            <span class="text-clr334 fnt-14 fnt-bold">Transaction {{ i + 1 }}</span>
                            <span
                                class="view-order delete-cta cursor-pointer pull-right"
                                (click)="updateEachVat(item, i)"
                            >
                                Edit
                            </span>
                        </label>
                        <table class="mtable">
                            <tr>
                                <td class="fnt-14 fnt-multi fnt-bold text-clr588">Country</td>
                                <td class="fnt-14 fnt-multi fnt-bold text-clr334">{{ item.country | country }}</td>
                            </tr>
                            <tr>
                                <td class="fnt-14 fnt-multi fnt-bold text-clr588">Transaction Type</td>
                                <td class="fnt-14 fnt-multi fnt-bold text-clr334">{{ item.transaction_type }}</td>
                            </tr>
                            <tr>
                                <td class="fnt-14 fnt-multi fnt-bold text-clr588">VAT</td>
                                <td class="fnt-14 fnt-multi fnt-bold text-clr334">{{ item.vat_percentage }}%</td>
                            </tr>
                        </table>
                    </div>
                    <div class="featureSectionCard" *ngIf="editIndex == i">
                        <label for="" class="header mb-0 px-2">
                            <span class="text-clr334 fnt-16 fnt-multi fnt-bold">Transaction {{ i + 1 }}</span>
                            <span
                                *ngIf="item.id"
                                class="view-order delete-cta fnt-14 cursor-pointer pull-right"
                                (click)="deleteEachVat(eachId)"
                            >
                                Delete
                            </span>
                            <span
                                *ngIf="!item.id"
                                class="view-order delete-cta fnt-14 cursor-pointer pull-right"
                                (click)="deleteRow(i)"
                            >
                                Delete
                            </span>
                        </label>
                        <form [formGroup]="transaction" novalidate (submit)="saveEachMrVat(item.id, transaction.value)">
                            <div class="col-12 form-group sewn-form-field px-2">
                                <label class="required">Country</label>
                                <select
                                    id="country"
                                    class="form-control select-region"
                                    formControlName="country"
                                    (change)="changeCountry()"
                                >
                                    <option value="" selected="" disabled="">Select a Country</option>
                                    <option
                                        *ngFor="let count of roasteryProfileService.countryList"
                                        value="{{ count.isoCode }}"
                                    >
                                        {{ count.name }}
                                    </option>
                                </select>
                                <span
                                    class="p-error fnt-14 fnt-muli"
                                    *ngIf="
                                        detailsFormControl.country.touched &&
                                        detailsFormControl.country.errors?.required
                                    "
                                >
                                    Country is required
                                </span>
                            </div>
                            <div class="col-12 form-group sewn-form-field px-2">
                                <label class="required">Transaction type</label>
                                <input type="text" class="form-control" formControlName="transaction_type" />
                                <span
                                    class="p-error fnt-14 fnt-muli"
                                    *ngIf="
                                        detailsFormControl.transaction_type.touched &&
                                        detailsFormControl.transaction_type.errors?.required
                                    "
                                >
                                    Transaction type is required
                                </span>
                            </div>
                            <div class="col-12 form-group sewn-form-field px-2">
                                <label class="required">VAT Percentage</label>
                                <input type="number" class="form-control" formControlName="vat_percentage" />
                                <span
                                    class="p-error fnt-14 fnt-muli"
                                    *ngIf="
                                        detailsFormControl.vat_percentage.touched &&
                                        detailsFormControl.vat_percentage.errors?.required
                                    "
                                >
                                    VAT is required
                                </span>
                            </div>
                            <button type="submit" class="col-12 btn btn-raised mb-3" [disabled]="!transaction.valid">
                                Save
                            </button>
                            <button type="button" class="col-12 btn btn-stroked mb-3" (click)="cancelItem(item, i)">
                                Cancel
                            </button>
                        </form>
                    </div>
                </div>
                <!--Tablet View-->
                <div class="col-12 p-3 tabletView">
                    <div class="featureSectionCard">
                        <table class="tTable">
                            <thead class="header-bg">
                                <tr>
                                    <th>Country</th>
                                    <th>Transaction</th>
                                    <th>VAT Rate</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of mrList; let i = index">
                                    <td>
                                        <span *ngIf="editIndex != i"> {{ item.country | country }} </span>
                                        <div class="form-group mb-0" *ngIf="editIndex == i">
                                            <select
                                                class="form-control select-region"
                                                [(ngModel)]="item.country"
                                                (change)="changeCountry()"
                                            >
                                                <option value="" selected="" disabled="">Select a Country</option>
                                                <option
                                                    *ngFor="let count of roasteryProfileService.countryList"
                                                    value="{{ count.isoCode }}"
                                                >
                                                    {{ count.name }}
                                                </option>
                                            </select>
                                        </div>
                                    </td>
                                    <td>
                                        <span *ngIf="editIndex != i"> {{ item.transaction_type }} </span>
                                        <div class="form-group mb-0" *ngIf="editIndex == i">
                                            <input
                                                type="text"
                                                class="form-control"
                                                [(ngModel)]="item.transaction_type"
                                            />
                                        </div>
                                    </td>
                                    <td>
                                        <span *ngIf="editIndex != i"> {{ item.vat_percentage }}%</span>
                                        <div class="form-group mb-0" *ngIf="editIndex == i">
                                            <input
                                                type="number"
                                                class="form-control"
                                                [(ngModel)]="item.vat_percentage"
                                            />
                                        </div>
                                    </td>
                                    <td>
                                        <span
                                            *ngIf="editIndex != i"
                                            class="view-order delete-cta fnt-14 cursor-pointer"
                                            (click)="updateEachVat(item, i)"
                                            >Edit</span
                                        >
                                        <span *ngIf="editIndex == i">
                                            <button
                                                class="btn btn-raised mr-2"
                                                (click)="saveEachMrVat(item.id, item, true)"
                                            >
                                                Save
                                            </button>
                                            <span
                                                *ngIf="item.id"
                                                class="view-order delete-cta fnt-14 cursor-pointer"
                                                (click)="deleteEachVat(eachId)"
                                            >
                                                Delete
                                            </span>
                                            <span
                                                *ngIf="!item.id"
                                                class="view-order delete-cta fnt-14 cursor-pointer"
                                                (click)="deleteRow(i)"
                                            >
                                                Delete
                                            </span>
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-12 mt-2">
                    <span class="view-order cursor-pointer" (click)="addNewTranscation()">Add new transaction </span>
                </div>
            </div>
        </div>
    </div>
</section>
