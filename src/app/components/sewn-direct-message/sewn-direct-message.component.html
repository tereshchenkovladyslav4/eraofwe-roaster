<section>

    <!--Chat Main screen with accounts-->
    <div class="chat mt-chat " data-element="chat"
         [ngClass]="{'open':(chatService.isOpen|async) , 'expand-active': (chatService.isOpen|async) && openedThread && (chatService.isExpand|async) }">
        <!--Remove expand mode-->
        <div class="chat-head">
            <button class="back-to-shrinkMode" (click)="closeExapndView()">
                <img src="assets/images/dm-back-arrow.svg">
            </button>
        </div>



        <!--Chat body-->
        <div class="chat-body ">

            <!--Expand Mode div-->
            <div class="chat-body__expand" data-element="chat-body-expand">
                <ng-container *ngIf="(chatService.isExpand|async)">
                    <div class="live-caht__head clearfix" data-element="live-chat-head">
                        <div class="live-account-profile">
                            <button class="back-to-accounts" (click)="backToAccountListing() ">
                                <img src="assets/images/dm-back-arrow.svg">
                            </button>

                            <div class="d-inline-block profile-pic">

                                <span class="profile-pic__item bg-profile"
                                      [style.backgroundImage]="openedThread?.computed_targetedUser.computed_profile_dp"></span>
                                <span *ngIf="openedThread?.computed_targetedUser.online" class="live-account"></span>
                                <span *ngIf="!openedThread?.computed_targetedUser.online"
                                      class="offline-account"></span>
                            </div>
                            <div class="chat-profile clearfix">
                                <div class="chat-profile__name d-inline-block">
                                    <h5 class="name"> {{openedThread?.computed_targetedUser.computed_fullname}}
                                    </h5>
                                    <span class="status">
                                        {{ openedThread?.computed_targetedUser.computed_organization_name}}
                                    </span>
                                    <span>&nbsp;</span>
                                    <span *ngIf="!openedThread?.computed_targetedUser.online && openedThread?.computed_targetedUser?.computed_lastseen"
                                          class="status last-seen">
                                        Last Seen at
                                        {{openedThread?.computed_targetedUser?.computed_lastseen}}
                                    </span>
                                </div>


                            </div>

                            <div class="chat-seeting position-relative" *ngIf="openedThread">
                                <a class="menu-arrow">
                                    <p><img class="ellipse-image" src="/assets/images/ellipses.png" alt="">
                                    </p>
                                </a>

                                <div class="chat-seeting__items">
                                    <ul class="list-group custom-popover chat-seeting__content">
                                        <li *ngIf="!openedThread.computed_mute" class="list-group-item "
                                            (click)="openedThread.computed_mute = true;">
                                            <a class="pointer-item">Mute </a>
                                        </li>
                                        <li *ngIf="openedThread.computed_mute" class="list-group-item "
                                            (click)="openedThread.computed_mute = false;">
                                            <a class="pointer-item">Unmute </a>
                                        </li>

                                        <li class="list-group-item list-group-item__disabled"><a
                                               class="pointer-item">{{globals.languageJson?.mark_unread}}</a>
                                        </li>
                                        <li class="list-group-item list-group-item__disabled"><a
                                               class="pointer-item">{{globals.languageJson?.archive}}</a>
                                        </li>
                                        <li class="list-group-item list-group-item__disabled"><a
                                               class="pointer-item">{{globals.languageJson?.report}}</a>
                                        </li>
                                        <li class="list-group-item list-group-item__disabled"><a
                                               class="pointer-item">{{globals.languageJson?.delete_conversation}}</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!--Live Chats are going here-->
                    <div class="live-chat-message-body position-relative" data-element="live-chat-message-body">

                        <span *ngFor="let message of messageList; let last = last" [attr.data-chat-id]="message.id">
                            <span appLifecyclehook (viewChecked)="last && lastMessageRendered.next('done')">
                                <div class="message-to live-chat-message-body__text" *ngIf="message.isActiveUser">
                                    <p class="live-time">{{message.computed_date}}</p>
                                    <div class="message-body">
                                        <div class="message-to__text"><span>{{message.content}}</span></div>
                                    </div>
                                </div>
                                <div class="message-from live-chat-message-body__text" *ngIf="!message.isActiveUser">
                                    <p class="live-time-from">{{message.computed_date}}</p>
                                    <div class="message-body-from">
                                        <div class="message-to__from "><span>{{message.content}}</span></div>
                                    </div>
                                </div>
                            </span>
                            <span class="done"></span>
                        </span>
                    </div>

                    <div data-element="message-form">
                        <div class="messag-form position-relative">

                            <div class="offensive-lang" [ngClass]="{'active':showOffensiveMessageError}">
                                <span>Use of offensive language is strictly prohibited using within member to
                                    member
                                    messaging, onour public groups, non-compliance may lead to permanent /
                                    temporary
                                    suspension of your account.</span>
                            </div>
                            <div class="img-container">
                                <span class="img-container__remove">&#10008;</span>
                            </div>

                            <div class="chat-inputs">
                                <label class="chat-inputs__img">
                                    <img src="assets/images/dm-img-upload.svg">
                                    <input type="file" class="files">

                                </label>
                                <textarea (keypress)="inputkeyPress($event)" (input)="inputChanges($event)"
                                          data-element="messag-text-area" type="text" rows="1" class="chat-inputs__text"
                                          placeholder="Type something.." [(ngModel)]="messageInput"></textarea>
                                <div class="send-message">
                                    <button (click)="sendMessage()" type="button" class="send-message__btn">

                                        <img src="assets/images/dm-send2.svg">
                                    </button>
                                </div>

                            </div>
                            <div class="send-message">
                                <button (click)="sendMessage()" type="button" class="send-message__btn">
                                    <span>send</span>
                                    <img src="assets/images/dm-send.svg">
                                </button>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>

            <!--Chat box witn live chat and account sections-->
            <div class="chat-box clearfix" data-element="chat-box">
                <div class="chat-accounts position-relative">
                    <div data-element="chat-account-head" class="chat-accounts__head clearfix">
                        <h4 class="chat-title">{{globals.languageJson?.messaging}}</h4>

                        <!--Chat control-->
                        <div class="chat-control">
                            <div class="chat-control__expand" [ngClass]="{'d-block':openedThread}"
                                 (click)="toggleExpandView() ">
                                <img *ngIf="!(chatService.isExpand|async)" src="assets/images/dm-expand.svg">
                                <img *ngIf="(chatService.isExpand|async)" src="assets/images/dm-collapse.svg">
                            </div>
                            <div class="chat-control__close" (click)="closePanel();">
                                <img src="assets/images/dm-close.svg">
                            </div>
                        </div>

                    </div>

                    <!---Live chats at particular account-->
                    <!-- <ng-template #liveChatRef> -->
                    <div data-element="live-chat" class="live-chat"
                         [ngClass]="{'active' : openedThread && !(chatService.isExpand|async) }">
                        <ng-container *ngIf="!(chatService.isExpand|async)">
                            <div class="live-caht__head clearfix" data-element="live-chat-head">
                                <div class="live-account-profile">
                                    <button class="back-to-accounts" (click)="backToAccountListing() ">
                                        <img src="assets/images/dm-back-arrow.svg">
                                    </button>

                                    <div class="d-inline-block profile-pic">

                                        <span class="profile-pic__item bg-profile"
                                              [style.backgroundImage]="openedThread?.computed_targetedUser.computed_profile_dp"></span>
                                        <span *ngIf="openedThread?.computed_targetedUser.online"
                                              class="live-account"></span>
                                        <span *ngIf="!openedThread?.computed_targetedUser.online"
                                              class="offline-account"></span>
                                    </div>
                                    <div class="chat-profile clearfix">
                                        <div class="chat-profile__name d-inline-block">
                                            <h5 class="name"> {{openedThread?.computed_targetedUser.computed_fullname}}
                                            </h5>
                                            <span
                                                  class="status">{{ openedThread?.computed_targetedUser.computed_organization_name}}</span>
                                            <span>&nbsp;</span>
                                            <span *ngIf="!openedThread?.computed_targetedUser.online  && openedThread?.computed_targetedUser?.computed_lastseen"
                                                  class="status last-seen">Last Seen at
                                                {{openedThread?.computed_targetedUser?.computed_lastseen || ''}}
                                            </span>
                                        </div>


                                    </div>
                                    <div class="chat-seeting position-relative" *ngIf="openedThread">
                                        <a class="menu-arrow">
                                            <p><img class="ellipse-image" src="/assets/images/ellipses.png" alt="">
                                            </p>
                                        </a>

                                        <div class="chat-seeting__items">
                                            <ul class="list-group custom-popover chat-seeting__content">
                                                <li *ngIf="!openedThread.computed_mute" class="list-group-item "
                                                    (click)="openedThread.computed_mute = true;">
                                                    <a class="pointer-item">Mute </a>
                                                </li>
                                                <li *ngIf="openedThread.computed_mute" class="list-group-item "
                                                    (click)="openedThread.computed_mute = false;">
                                                    <a class="pointer-item">Unmute </a>
                                                </li>

                                                <li class="list-group-item list-group-item__disabled"><a
                                                       class="pointer-item">{{globals.languageJson?.mark_unread}}</a>
                                                </li>
                                                <li class="list-group-item list-group-item__disabled"><a
                                                       class="pointer-item">{{globals.languageJson?.archive}}</a>
                                                </li>
                                                <li class="list-group-item list-group-item__disabled"><a
                                                       class="pointer-item">{{globals.languageJson?.report}}</a>
                                                </li>
                                                <li class="list-group-item list-group-item__disabled"><a
                                                       class="pointer-item">{{globals.languageJson?.delete_conversation}}</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!--Live Chats are going here-->
                            <div class="live-chat-message-body position-relative" data-element="live-chat-message-body">

                                <span *ngFor="let message of messageList; let last = last"
                                      [attr.data-chat-id]="message.id">
                                    <span appLifecyclehook (viewChecked)="last && lastMessageRendered.next('done')">
                                        <div class="message-to live-chat-message-body__text"
                                             *ngIf="message.isActiveUser">
                                            <p class="live-time">{{message.computed_date}}</p>
                                            <div class="message-body">
                                                <div class="message-to__text "><span>{{message.content}}</span></div>
                                            </div>
                                        </div>
                                        <div class="message-from live-chat-message-body__text"
                                             *ngIf="!message.isActiveUser">
                                            <p class="live-time-from">{{message.computed_date}}</p>
                                            <div class="message-body-from">
                                                <div class="message-to__from "><span>{{message.content}}</span></div>
                                            </div>
                                        </div>
                                    </span>
                                    <span class="done"></span>
                                </span>
                            </div>

                            <!--Send Message div-->
                            <div data-element="message-form">
                                <div class="messag-form position-relative">

                                    <div class="offensive-lang" [ngClass]="{'active':showOffensiveMessageError}">
                                        <span>Use of offensive language is strictly prohibited using within member to
                                            member
                                            messaging, onour public groups, non-compliance may lead to permanent /
                                            temporary
                                            suspension of your account.</span>
                                    </div>
                                    <div class="img-container">
                                        <span class="img-container__remove">&#10008;</span>
                                    </div>

                                    <div class="chat-inputs">
                                        <label class="chat-inputs__img">
                                            <img src="assets/images/dm-img-upload.svg">
                                            <input type="file" class="files">

                                        </label>
                                        <textarea (keypress)="inputkeyPress($event)" (input)="inputChanges($event)"
                                                  data-element="messag-text-area" type="text" rows="1"
                                                  class="chat-inputs__text" placeholder="Type something.."
                                                  [(ngModel)]="messageInput"></textarea>
                                        <div class="send-message">
                                            <button (click)="sendMessage()" type="button" class="send-message__btn">

                                                <img src="assets/images/dm-send2.svg">
                                            </button>
                                        </div>

                                    </div>
                                    <div class="send-message">
                                        <button (click)="sendMessage()" type="button" class="send-message__btn">
                                            <span>send</span>
                                            <img src="assets/images/dm-send.svg">
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                    <!-- </ng-template> -->

                    <!-- <ng-template [ngTemplateOutlet]="liveChatRef"></ng-template> -->

                    <!--Account Setting-->

                    <div data-element="account-setting" class="account-setting">
                        <div class="account-setting__back">
                            <div class="back-to-conversation">
                                <img src="assets/images/dm-back-arrow.svg">
                                <span>Back to Conversation list</span>
                            </div>

                            <div class="account-setting__profile clearfix">
                                <div class="set-profile">
                                    <img src="assets/images/dm-account-profile.png">
                                </div>

                                <div class="set-profile-name">
                                    <h5 class="name">Umesh</h5>
                                    <span class="status">Coffee Estate</span>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!--All accounts body with search-->
                    <div data-element="account-body" class="chat-accounts__body"
                         [ngClass]="{'active' :  !openedThread || (chatService.isExpand|async)}">
                        <div class="search-account">
                            <img src="assets/images/dm-search.svg">
                            <input [(ngModel)]="threadSearchKeyword" class="search-account__input" type="search"
                                   placeholder="Search Messages">
                        </div>

                        <div class="chat-accounts__name">

                            <!--Account-->
                            <div class="clearfix account"
                                 *ngFor="let thread of threadList|searchFilter:threadSearchKeyword"
                                 (click)="openThreadChat(thread)">
                                <div class="d-inline-block profile-pic">
                                    <span class="profile-pic__item bg-profile"
                                          [style.backgroundImage]="thread.computed_targetedUser.computed_profile_dp"></span>
                                    <span *ngIf="thread.computed_targetedUser.online" class="live-account"></span>
                                    <span *ngIf="!thread.computed_targetedUser.online" class="offline-account"></span>
                                </div>
                                <div class="chat-profile clearfix">
                                    <div class="chat-profile__name d-inline-block">
                                        <h5 class="name">{{thread.computed_targetedUser.computed_fullname}}</h5>
                                        <span
                                              class="status">{{ thread.computed_targetedUser.computed_organization_name}}</span>
                                    </div>
                                    <div class="chat-profile__time ">
                                        <span>{{thread.computed_createdAt}}</span>
                                    </div>
                                    <div class="chat-messaged">
                                        <p class="chat-messaged__text">{{thread.computed_lastActivityText}}
                                        </p>
                                        <span *ngIf="thread.unread && thread.unread > 0"
                                              class="chat-messaged__total">{{thread.unread}}</span>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- <div class="start-chat">
        <span>Start Chat</span>
    </div> -->

</section>
