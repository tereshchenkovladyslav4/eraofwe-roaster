<div class="total-loader" *ngIf="messagingActive !=1">
    <!-- <img class="loader-gif-sub" src="/assets/images/loader.gif"> -->
    <div><img class="loader-gif web-loader" src="/assets/images/loader.gif">
        <img class="loader-gif mob-loader" src="/assets/images/coffeeloader-mobile.gif">
    </div>
</div>
<div *ngIf="messagingActive == 1">
    <section>
        <!-- <div class="imageFile"></div> -->
        <!--Chat Main screen with accounts-->
        <div class="chat mt-chat">
            <!--Remove expand mode-->
            <div class="chat-head">
                <button class="back-to-shrinkMode">
                    <img src="assets/images/dm-back-arrow.svg">
                </button>
            </div>



            <!--Chat body-->
            <div class="chat-body">

                <!--Expand Mode div-->
                <div class="chat-body__expand"></div>

                <!--Chat box witn live chat and account sections-->
                <div class="chat-box clearfix">
                    <div class="chat-accounts position-relative">
                        <div class="chat-accounts__head clearfix">
                            <h4 class="chat-title">{{globals.languageJson?.messaging}}</h4>

                            <!--Chat control-->
                            <div class="chat-control">
                                <div class="chat-control__expand">
                                    <img src="assets/images/dm-expand.svg">
                                </div>
                                <div class="chat-control__close">
                                    <img src="assets/images/dm-close.svg">
                                </div>
                            </div>

                        </div>



                        <!---Live chats at particular account-->
                        <div class="live-chat">
                            <div class="live-caht__head clearfix">
                                <div class="live-account-profile">
                                    <button class="back-to-accounts">
                                        <img src="assets/images/dm-back-arrow.svg">
                                    </button>
                                    <div class="d-inline-block profile-pic">
                                        <img class="profile-pic__item" src="assets/images/dm-profile.png">
                                        <span class="live-account"></span>
                                    </div>
                                    <div class="chat-profile clearfix">
                                        <div class="chat-profile__name chat-img-name d-inline-block">
                                            <h5 class="name">{{activeThreadName}}</h5>
                                            <!-- <span class="status">Coffee Estate</span> -->
                                            <span class="status last-seen">{{globals.languageJson?.last_seen}} 4:30pm
                                            </span>
                                        </div>
                                    </div>

                                    <div class="chat-seeting position-relative">
                                        <a class="menu-arrow">
                                            <p><img class="ellipse-image" src="/assets/images/ellipses.png" alt=""></p>
                                        </a>

                                        <div class="chat-seeting__items">
                                            <ul class="list-group custom-popover chat-seeting__content">
                                                <li class="list-group-item"> <a
                                                       class="pointer-item">{{globals.languageJson?.mute}} </a></li>
                                                <li class="list-group-item"><a
                                                       class="pointer-item">{{globals.languageJson?.mark_unread}}</a>
                                                </li>
                                                <li class="list-group-item"><a
                                                       class="pointer-item">{{globals.languageJson?.archive}}</a></li>
                                                <li class="list-group-item"><a class="pointer-item"
                                                       (click)=" reportChat();">{{globals.languageJson?.report}}</a>
                                                </li>
                                                <li class="list-group-item"><a class="pointer-item"
                                                       (click)="deleteChat();">{{globals.languageJson?.delete_conversation}}</a>
                                                </li>
                                            </ul>
                                        </div>

                                    </div>
                                </div>
                            </div>


                            <!--Live Chats are going here-->
                            <div class="live-chat-message-body position-relative">
                                <span *ngFor="let message of threadsMessageData[activeThread]">
                                    <span *ngIf="message.activity_type == 'M'">
                                        <div class="message-to live-chat-message-body__text"
                                             *ngIf="message.currentUser != message.member.id">
                                            <div class="message-body">
                                                <div class="message-to__text "><span>{{message.content}}</span></div>
                                            </div>
                                            <p class="live-time">{{getReadableTime(message.created_at)}}</p>
                                            <p> {{message.currentUser}} | {{message.member.id}} </p>
                                        </div>

                                        <!-- <div class="message-to live-chat-message-body__text" *ngIf = "message.currentUser == -1">
                                    <div class="message-body">
                                        <div class="message-to__text "><span>{{message.content}}</span></div>
                                    </div>
                                    <p class="live-time">{{getReadableTime(message.created_at)}}</p>
                                </div> -->

                                        <div class="message-from live-chat-message-body__text"
                                             *ngIf="message.currentUser == message.member.id">
                                            <div class="message-body-from">
                                                <div class="message-to__from "><span>{{message.content}}</span></div>
                                            </div>
                                            <p class="live-time-from">{{getReadableTime(message.created_at)}}</p>
                                        </div>

                                    </span>
                                    <span class="done"></span>
                                </span>
                            </div>

                            <!--Send Message div-->
                            <div>
                                <form class="messag-form position-relative">

                                    <div class="offensive-lang">
                                        <span>{{globals.languageJson?.language_prohibited}}...</span>
                                    </div>
                                    <div class="img-container">
                                        <span class="img-container__remove">&#10008;</span>
                                    </div>

                                    <div class="chat-inputs">
                                        <label class="chat-inputs__img">
                                            <img src="assets/images/dm-img-upload.svg">
                                            <input type="file" class="files">

                                        </label>
                                        <textarea type="text" rows="1" class="chat-inputs__text"
                                                  placeholder="Type something.."></textarea>
                                        <div class="send-message">
                                            <button type="button" class="send-message__btn" (click)="sendMessage()">

                                                <img src="assets/images/dm-send2.svg">
                                            </button>
                                        </div>

                                    </div>
                                    <div class="send-message">
                                        <button type="button" class="send-message__btn" (click)="sendMessage()">
                                            <span>{{globals.languageJson?.send}}</span>
                                            <img src="assets/images/dm-send.svg">
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>


                        <!--Account Setting-->

                        <div class="account-setting">
                            <div class="account-setting__back">
                                <div class="back-to-conversation">
                                    <img src="assets/images/dm-back-arrow.svg">
                                    <span>{{globals.languageJson?.back_conversation}}</span>
                                </div>

                                <div class="account-setting__profile clearfix">
                                    <div class="set-profile">
                                        <img src="assets/images/dm-account-profile.png">
                                    </div>

                                    <div class="set-profile-name">
                                        <h5 class="name">Umesh</h5>
                                        <span class="status">Coffee Estate</span>
                                    </div>
                                </div>

                                <!--Account setting options-->
                                <div class="account-setting-option">

                                    <!--Search in conversion-->
                                    <div class="account-setting-option__item">
                                        <a class="d-flex justify-content-between align-items-center" href="#"><span
                                                  class="fnt-16 fnt-muli fnt-600 text-black334 d-inline-block">{{globals.languageJson?.serach_conversation}}</span><img
                                                 class="ml-auto" src="assets/images/setting-arrow.svg"></a>
                                    </div>


                                    <!--Clear Conversion-->
                                    <div
                                         class="account-setting-option__item d-flex justify-content-between align-items-center">
                                        <span
                                              class="fnt-16 fnt-muli fnt-600 text-black334 d-inline-block">{{globals.languageJson?.notifications}}</span>
                                        <div class="notification-control ml-auto">
                                            <input type="radio" name="notification" value="off">
                                            <input type="radio" name="notification" value="on">
                                            <span class="switch-control"></span>
                                        </div>
                                    </div>

                                    <!--Clear Conversion-->
                                    <div class="account-setting-option__item">
                                        <a class="d-flex justify-content-between align-items-center" href="#"><span
                                                  class="fnt-16 fnt-muli fnt-600 text-black334 d-inline-block">{{globals.languageJson?.clear_conversation}}</span><img
                                                 class="ml-auto" src="assets/images/setting-arrow.svg"></a>
                                    </div>

                                    <!--Report User-->
                                    <div class="account-setting-option__item">
                                        <a class="d-flex justify-content-between align-items-center" href="#"><span
                                                  class="fnt-16 fnt-muli fnt-600 text-black334 d-inline-block">{{globals.languageJson?.report_user}}</span><img
                                                 class="ml-auto" src="assets/images/setting-arrow.svg"></a>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!--All accounts body with search-->
                        <div class="chat-accounts__body active">
                            <div class="search-account">
                                <!-- <input class="search-account__input pt-1" id="searchResult" type="search" placeholder="Search Messages"> -->
                                <div class="ng-autocomplete" width="40px">
                                    <ng-autocomplete [data]="searchResult" [searchKeyword]="keyword"
                                                     (selected)='selectEvent($event)'
                                                     (inputChanged)='onChangeSearch($event)'
                                                     (inputFocused)='onFocused($event)' [itemTemplate]="itemTemplate"
                                                     [notFoundTemplate]="notFoundTemplate"
                                                     placeholder="Search name or email">
                                        <img src="assets/images/dm-search.svg">
                                    </ng-autocomplete>

                                    <ng-template #itemTemplate let-item>
                                        <a href="javascript:void(0)">
                                            <span [innerHTML]="item.firstname"></span>
                                            <span [innerHTML]="item.lastname"></span>
                                        </a>
                                    </ng-template>

                                    <ng-template #notFoundTemplate let-notFound>
                                        <div [innerHTML]="notFound"></div>
                                    </ng-template>
                                </div>
                            </div>

                            <div class="chat-accounts__name">

                                <!--Account-->
                                <div class="clearfix account {{data.name}}" (click)="getChatHistory(data.id, data)"
                                     *ngFor="let data of threadsData">
                                    <div class="d-inline-block profile-pic chat-img-name">
                                        <img class="profile-pic__item" src="assets/images/dm-profile.png">
                                        <span class="live-account"></span>
                                    </div>
                                    <div class="chat-profile clearfix">
                                        <div class="chat-profile__name d-inline-block">
                                            <h5 class="name">{{data.name}}</h5>
                                            <span
                                                  class="status">{{getOrganization(data.activity_member_org_type)}}</span>
                                        </div>
                                        <!-- <div class="chat-profile__time d-inline-block">
                                    <span>{{getReadableTime(threadLastMessages[data.id].created_at)}}</span>
                                </div>
                                <div class="chat-messaged">
                                    <p class="chat-messaged__text">{{ showContent(threadLastMessages[data.id].content) }}
                                    </p>
                                    
                                </div> -->

                                    </div>
                                </div>

                                <!-- Account
                        <div class="clearfix account vijay">
                            <div class="d-inline-block profile-pic chat-img-name">
                                <img class="profile-pic__item" src="assets/images/dm-profile.png">
                                <span class="offline-account"></span>
                            </div>
                            <div class="chat-profile clearfix">
                                <div class="chat-profile__name d-inline-block">
                                    <h5 class="name">Vijay</h5>
                                    <span class="status">Coffee Estate</span>
                                </div>
                                <div class="chat-profile__time d-inline-block">
                                    <span>2.30</span><span>am</span>
                                </div>
                                <div class="chat-messaged">
                                    <p class="chat-messaged__text">The coffee has been graded and sent to..
                                    </p>
                                    <span class="chat-messaged__total">2</span>
                                </div>

                            </div>
                        </div> -->

                                <!--Account-->
                                <!-- <div class="clearfix account dinesh">
                            <div class="d-inline-block profile-pic chat-img-name">
                                <img class="profile-pic__item" src="assets/images/dm-profile.png">
                                <span class="offline-account"></span>
                            </div>
                            <div class="chat-profile clearfix">
                                <div class="chat-profile__name d-inline-block">
                                    <h5 class="name">Dinesh</h5>
                                    <span class="status">Coffee Estate</span>
                                </div>
                                <div class="chat-profile__time d-inline-block">
                                    <span>2.30</span><span>am</span>
                                </div>
                                <div class="chat-messaged">
                                    <p class="chat-messaged__text">The coffee has been graded and sent to..
                                    </p>
                                    <span class="chat-messaged__total">2</span>
                                </div>

                            </div>
                        </div> -->

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- <div class="start-chat">
    <span>Start Chat</span>
</div> -->

    </section>

    <ng-template #deletetemplate>
        <div class="modal-header">
            <!-- <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
            <span aria-hidden="true">&times;</span>
          </button> -->
        </div>
        <div class="modal-body text-center mb-5">
            <img class="alert-msg" src="/assets/images/alert-messaging.png" alt="">
            <div class="are-sure fnt-play">
                Are you sure
            </div>
            <div class="do-account pt-1 pb-2">Do you really want to delete this conversation</div>
            <div class="pt-4 ">
                <button class="btn add-btn mr-3" (click)="modalRef.hide();">Yes</button>
                <button class="btn no-btun" (click)="modalRef.hide();">No</button>
            </div>


        </div>
    </ng-template>

    <ng-template #reporttemplate>
        <div class="modal-header">
            <!-- <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
            <span aria-hidden="true">&times;</span>
          </button> -->
        </div>
        <div class="modal-body text-center mb-5">
            <img class="alert-msg" src="/assets/images/alert-messaging.png" alt="">
            <div class="are-sure fnt-play">
                want to report?
            </div>
            <div class="do-account pt-1 pb-2">Do you really want to report this profile</div>

            <div class="pt-4 ">
                <button class="btn add-btn mr-3" (click)="modalRef.hide();">Yes</button>
                <button class="btn no-btun" (click)="modalRef.hide();">No</button>
            </div>




        </div>
    </ng-template>
</div>
